(function(){"use strict";function n(n,t,i,r,u,f){var e,s,c;$("[data-toggle=tooltip]").tooltip({trigger:"hover"});f.reset();f.title=r.lbl_Prfl;f.showToolBar=!0;f.showAddBtn=!1;f.refreshBtnTltp=r.msg_RfrshPrfl;f.saveBtnTltp=r.msg_SavePrfl;e=this;e.appProps=r;e.hidePassword=!0;e.errorstatus="";e.errormsg="";e.errorid=0;e.profile={fName:"",lName:"",email:"",emailLocked:!1,emailToVal:"",emailToValToken:"",emailToValSent:!1,userName:"",userNameLocked:!1,contactNumber:"",isEmailValidated:!1,accessFailedCount:0,emailConfirmed:!1,lockoutEnabled:!1};e.cancelingEmail=!1;e.resendingEmail=!1;e.password={oldPassword:null,newPassword:null,cnfrmPassword:null};var l=function(n){if(n.data&&n.data.result){if(e.profile.fName=n.data.result.fName,e.profile.lName=n.data.result.lName,e.profile.email=n.data.result.email,e.profile.emailLocked=n.data.result.emailLocked,e.profile.emailToVal=n.data.result.emailToVal,e.profile.emailToValToken=n.data.result.emailToValToken,e.profile.emailToValSent=n.data.result.emailToValSent,e.profile.userName=n.data.result.userName,e.profile.userNameLocked=n.data.result.userNameLocked,e.profile.contactNumber=n.data.result.contactNumber,e.profile.isEmailValidated=n.data.result.isEmailValidated,e.profile.accessFailedCount=n.data.result.accessFailedCount,e.profile.emailConfirmed=n.data.result.emailConfirmed,e.profile.lockoutEnabled=n.data.result.lockoutEnabled,n.data.fn){var t=globalOptns.lbl_HelloNm.replace("{0}",n.data.fn).replace("{1}",globalOptns.lbl_NoNm);$("#topbar .container .navbar-right a.dropdown-toggle").text(t)}!e.profile.emailToValSent&&e.profile.emailToVal&&e.profile.emailToVal.length>0&&e.profile.emailToValToken&&e.profile.emailToValToken.length>0&&e.resendEmail()}},o=function(n){n.data&&checkRedirectForSignIn(n.data)&&(e.errorstatus=n.status+" - "+n.statusText,e.errormsg=n.data.msg,e.errorid=n.data.id)},h=function(){toggleGlblWaitVisibility(!1)};e.initPasswordFrm=function(n){n&&u.setItemFormValidation(n,[{name:"oldPassword",isReq:!0},{name:"newPassword",isReq:!0},{name:"cnfrmPassword",moreValidations:{name:"isEqualToNewPassword",func:function(){return n.newPassword===n.cnfrmPassword}}}])};e.changePasswordClick=function(){var t,i;e.errorstatus="";e.errormsg="";e.errorid=0;e.hidePassword?e.hidePassword=!e.hidePassword:(t={oldPassword:e.password.oldPassword,newPassword:e.password.newPassword},e.password.formVal.oldPassword.isTouched=!1,e.password.formVal.newPassword.isTouched=!1,e.password.formVal.cnfrmPassword.isTouched=!1,e.password.oldPassword=null,e.password.newPassword=null,e.password.cnfrmPassword=null,i=function(n){n&&n.data&&n.data.error?(e.errorstatus="",e.errormsg=n.data.error,e.errorid=0):e.hidePassword=!0},toggleGlblWaitVisibility(!0),n.post(r.urlChangePassword,t).then(i,o).finally(h))};e.changePasswordKeypressed=function(n,t){n&&n.keyCode===13&&e.password.formVal&&e.password.formVal.isValid()&&e.changePasswordClick(t)};e.passwordReady=function(){var n=$("div[uib-collapse]").find('input[name="oldPassword"]');n&&n.length>0&&n.focus()};e.manageProfile=function(t){t||(t=null);e.errorstatus="";e.errormsg="";e.errorid=0;toggleGlblWaitVisibility(!0);n.post(r.urlMngProfile,{profile:t}).then(l,o).finally(h)};s=function(){var t=function(n){n&&n.data&&n.data.result?e.manageProfile():i(s,5e3,1)};n.post(r.urlCheckEmailToken,{tokenValue:e.profile.emailToValToken}).then(t,t)};e.resendEmail=function(){e.resendingEmail=!0;var t=function(){i(s,5e3,1)},u=function(){e.resendingEmail=!1};n.post(r.urlMngProfile,{profile:{emailToVal:e.profile.emailToVal,emailToValToken:e.profile.emailToValToken},action:"resendemailconfirmation",skipGet:!0}).then(t,o).finally(u)};e.cancelEmail=function(){e.cancelingEmail=!0;var t=function(){e.profile.emailLocked=!1;e.profile.emailToVal="";e.profile.emailToValToken=""},i=function(){e.cancelingEmail=!1};n.post(r.urlMngProfile,{profile:null,action:"cancelemailconfirmation",skipGet:!0}).then(t,o).finally(i)};c=function(){var n=$(this);n.hasClass("refresh")?e.manageProfile():n.hasClass("save")&&e.manageProfile(e.profile)};$("#searchBar .btn.btn-tb").on("click",c)}angular.module("app-mainmenu").controller("profileCtrlr",["$http","$scope","$interval","appProps","listItemService","headerConfigService",n])})();