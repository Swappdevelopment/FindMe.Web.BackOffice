(function(){"use strict";function n(n,t,i,r){var u,e,o;$("[data-toggle=tooltip]").tooltip({trigger:"hover"});r.reset();r.title=i.lbl_Prfl;r.showToolBar=!0;r.showAddBtn=!1;r.refreshBtnTltp=i.msg_RfrshPrfl;r.saveBtnTltp=i.msg_SavePrfl;u=this;u.appProps=i;u.errorstatus="";u.errormsg="";u.errorid=0;u.profile={fName:"",lName:"",email:"",emailLocked:!1,emailToVal:"",emailToValToken:"",emailToValSent:!1,userName:"",userNameLocked:!1,contactNumber:"",isEmailValidated:!1,accessFailedCount:0,emailConfirmed:!1,lockoutEnabled:!1};u.cancelingEmail=!1;u.resendingEmail=!1;var s=function(n){if(n.data&&n.data.result){if(u.profile.fName=n.data.result.fName,u.profile.lName=n.data.result.lName,u.profile.email=n.data.result.email,u.profile.emailLocked=n.data.result.emailLocked,u.profile.emailToVal=n.data.result.emailToVal,u.profile.emailToValToken=n.data.result.emailToValToken,u.profile.emailToValSent=n.data.result.emailToValSent,u.profile.userName=n.data.result.userName,u.profile.userNameLocked=n.data.result.userNameLocked,u.profile.contactNumber=n.data.result.contactNumber,u.profile.isEmailValidated=n.data.result.isEmailValidated,u.profile.accessFailedCount=n.data.result.accessFailedCount,u.profile.emailConfirmed=n.data.result.emailConfirmed,u.profile.lockoutEnabled=n.data.result.lockoutEnabled,n.data.fn){var t=globalOptns.lbl_HelloNm.replace("{0}",n.data.fn).replace("{1}",globalOptns.lbl_NoNm);$("#topbar .container .navbar-right a.dropdown-toggle").text(t)}!u.profile.emailToValSent&&u.profile.emailToVal&&u.profile.emailToVal.length>0&&u.profile.emailToValToken&&u.profile.emailToValToken.length>0&&u.resendEmail()}},f=function(n){n.data&&checkRedirectForSignIn(n.data)&&(u.errorstatus=n.status+" - "+n.statusText,u.errormsg=n.data.msg,u.errorid=n.data.id)},h=function(){toggleGlblWaitVisibility(!1)};u.manageProfile=function(t){t||(t=null);u.errorstatus="";u.errormsg="";u.errorid=0;toggleGlblWaitVisibility(!0);n.post(i.urlMngProfile,{profile:t}).then(s,f).finally(h)};e=function(){var r=function(n){n&&n.data&&n.data.result?u.manageProfile():t(e,5e3,1)};n.post(i.urlCheckEmailToken,{tokenValue:u.profile.emailToValToken}).then(r,r)};u.resendEmail=function(){u.resendingEmail=!0;var r=function(){t(e,5e3,1)},o=function(){u.resendingEmail=!1};n.post(i.urlMngProfile,{profile:{emailToVal:u.profile.emailToVal,emailToValToken:u.profile.emailToValToken},action:"resendemailconfirmation",skipGet:!0}).then(r,f).finally(o)};u.cancelEmail=function(){u.cancelingEmail=!0;var t=function(){u.profile.emailLocked=!1;u.profile.emailToVal="";u.profile.emailToValToken=""},r=function(){u.cancelingEmail=!1};n.post(i.urlMngProfile,{profile:null,action:"cancelemailconfirmation",skipGet:!0}).then(t,f).finally(r)};o=function(){var n=$(this);n.hasClass("refresh")?u.manageProfile():n.hasClass("save")&&$('form[name="userProfileForm"]').submit()};$("#searchBar .btn.btn-tb").on("click",o);u.manageProfile()}angular.module("app-mainmenu").controller("profileCtrlr",["$http","$interval","appProps","headerConfigService",n])})();