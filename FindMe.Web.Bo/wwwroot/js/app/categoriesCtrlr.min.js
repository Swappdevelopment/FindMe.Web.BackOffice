(function(){"use strict";function n(n,t,i,r,u,f){var e,s,h,l;$("[data-toggle=tooltip]").tooltip({trigger:"hover"});f.reset();f.title=u.lbl_Categories;f.showToolBar=!0;f.showSearchCtrl=!0;f.showSaveBtn=!1;f.addBtnTltp=u.msg_AddCatgs;f.refreshBtnTltp=u.msg_RfrshCatgs;f.saveBtnTltp=u.msg_SaveCatgs;e=this;e.appProps=u;e.pgsCollection=[];e.currentPgNmbr=0;e.totalPgs=0;e.categorysCount=0;e.categorysCountMod=0;e.categorys=[];e.gotoPage=function(n,t){if(n&&!n.isActive&&!n.disabled){t;var i=u.resultItemsPerPg*n.index-1;i=i<0?0:i;e.currentPgNmbr=n.index;e.populateCategorys(u.resultItemsPerPg,i)}};e.deleteModal=function(n){r.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"deleteCategoryModal.html",controller:"deleteCategoryInstanceCtrlr",controllerAs:"vm",size:"lg",appendTo:$("#categorysVw .modal-container"),resolve:{param:function(){return{category:n,save:e.save}}}})};e.openModal=function(n){r.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"categoryModal.html",controller:"categoryInstanceCtrlr",controllerAs:"vm",size:"lg",appendTo:$("#categorysVw .modal-container"),resolve:{category:function(){return jQuery.extend(!0,{},n)}}})};e.goInEditMode=function(n,t){if(t&&(t.inEditMode=!0,n&&n.currentTarget)){var i=$(n.currentTarget).parents("tr").first();i&&i.length>0&&$("textarea[elastic]",i).trigger("input")}};s=function(){var n,t,i;if(e.pgsCollection.length=0,e.totalPgs>1){for(n=e.currentPgNmbr-2,t=e.currentPgNmbr+2,n<0&&(t+=0-n,n=0),t>=e.totalPgs&&(t=e.totalPgs-1);t-n<4;)n--;for(n=n<0?0:n,e.pgsCollection.push({index:0,isActive:!1,text:"",icon:"fa fa-step-backward",disabled:e.currentPgNmbr<=0}),i=n;i<=t;i++)e.pgsCollection.push({index:i,isActive:e.currentPgNmbr===i,text:String(i+1),icon:"",disabled:!1});e.pgsCollection.push({index:e.totalPgs-1,isActive:!1,text:"",icon:"fa fa-step-forward",disabled:e.currentPgNmbr>=e.totalPgs-1})}};h=function(n,t,i){n&&t&&(n.recordState=n.id>0?i?30:n.name_en!==t.name_en||n.name_fr!==t.name_fr||n.slug_en!==t.slug_en||n.slug_fr!==t.slug_fr||n.desc_en!==t.desc_en||n.desc_fr!==t.desc_fr||n.active!==t.active?20:0:10)};e.parentIdFilter=0;e.parentNameFilter="";e.setParentCatg=function(n){n&&n.id>0&&(e.parentIdFilter=n.id,e.parentNameFilter=String(u.currentLang).toLowerCase().startsWith("en")?n.name_en:n.name_fr,e.searchValue="",e.populateCategorys(u.resultItemsPerPg,0))};e.clearParentFilters=function(){e.parentIdFilter=0;e.parentNameFilter="";e.searchValue=$("#searchBar input.input-search").val();e.populateCategorys(u.resultItemsPerPg,0)};var a=!1,o="",c=0;e.populateCategorys=function(t,i,r){var f=!1;(r||o)&&(f=r!==o);f=f||c!==e.parentIdFilter||e.categorysCountMod!==0;c=e.parentIdFilter;o=r;e.showError=!1;e.errorstatus="";e.errormsg="";e.errorid=0;t=t?t:u.resultItemsPerPg;i=i?i:0;r=r?r:e.searchValue;var h=function(n){var r,i,t;if(e.categorys.length=0,n.data&&((n.data.count>0||n.data.count===0&&n.data.result&&n.data.result.length===0)&&(e.categorysCountMod=0,e.categorysCount=n.data.count,r=parseInt(e.categorysCount/u.resultItemsPerPg),r+=e.categorysCount%u.resultItemsPerPg>0?1:0,e.totalPgs=r),s(),n.data.result))for(i=0;i<n.data.result.length;i++)t=n.data.result[i],t.name=u.currentLang.startsWith("en")?t.name_en:t.name_fr,t.__comp=jQuery.extend(!0,{},t),e.categorys.push(t),t.inEditMode=!1,t.saving=!1},l=function(n){n.data&&checkRedirectForSignIn(n.data)&&(e.errorstatus=n.status+" - "+n.statusText,e.errormsg=n.data.msg,e.errorid=n.data.id,e.showError=!0)},v=function(){toggleGlblWaitVisibility(!1)};a=!1;toggleGlblWaitVisibility(!0);n.post(u.urlGetCatgs,{parentID:e.parentIdFilter,limit:t,offset:i,getTotalCatgs:e.categorysCount<=0||f,name:r?r:null}).then(h,l).finally(v)};e.revert=function(n){if(n&&n.__comp)if(n.id>0){var t=n.__comp;n.name_en=t.name_en;n.name_fr=t.name_fr;n.slug_en=t.slug_en;n.slug_fr=t.slug_fr;n.desc_en=t.desc_en;n.desc_fr=t.desc_fr;n.active=t.active;n.inEditMode=!1}else e.categorys.remove(n)};e.save=function(i,r,f){var c,s,l;if(i){Array.isArray(i)||(i=[i]);f&&!Array.isArray(f)&&(f=[f]);var o=[],a=[],v=f&&f.length===i.length;for(c=0;c<i.length;c++)s=i[c],s&&s.__comp&&(l=jQuery.extend(!0,{},s),delete l.__comp,h(l,s.__comp,v?f[c]:!1),a.push(l),s.saving=!0,o.push(s));if(o.length>0){var y=function(n){n.data&&n.data.result&&n.data.result.length>0&&o.length===n.data.result.length&&$.each(n.data.result,function(n,i){var r=o[n];i?(r.id=i.id,r.level=i.level,r.path=i.path,r.parent_Id=i.parent_Id,r.name_en=i.name_en,r.name_fr=i.name_fr,r.slug_en=i.slug_en,r.slug_fr=i.slug_fr,r.desc_en=i.desc_en,r.desc_fr=i.desc_fr,r.active=i.active,a[n].recordState===10&&(e.categorysCountMod+=1,(!e.totalPgs||e.totalPgs<=0)&&(e.totalPgs=1)),delete r.status,delete r.recordState,r.__comp=i):(e.categorys.remove(r),e.categorysCountMod-=1,e.categorysCount+e.categorysCountMod<=0&&(e.totalPgs=0));t.$apply()})},p=function(n){n.data&&checkRedirectForSignIn(n.data)&&(e.errorstatus=n.status+" - "+n.statusText,e.errormsg=n.data.msg,e.errorid=n.data.id,e.showError=!0)},w=function(){for(var n=0;n<o.length;n++)o[n].saving=!1,o[n].inEditMode=!1;r&&r()};e.showError=!1;e.errorstatus="";e.errormsg="";e.errorid=0;n.post(u.urlSaveCatgs,{catgs:a}).then(y,p).finally(w)}}};l=function(){var i=$(this),n,r;i.hasClass("refresh")?(n=$.grep(e.pgsCollection,function(n){return n.isActive}),n&&Array.isArray(n)&&(n=n.length>0?n[0]:null),n&&(r=u.resultItemsPerPg*n.index-1,t.$apply(function(){e.populateCategorys(u.resultItemsPerPg,r)}))):i.hasClass("add")&&t.$apply(function(){var n={id:0,level:0,path:"",parent_Id:e.parentIdFilter>0?e.parentIdFilter:null,name_en:null,name_fr:null,slug_en:null,slug_fr:null,desc_en:null,desc_fr:null,active:!0};n.__comp=jQuery.extend(!0,{},n);n.inEditMode=!0;n.saving=!1;e.categorys.insert(0,n)})};$("#searchBar .btn.btn-tb").on("click",l);$("#searchBar").on("searchGo",function(n,i){i&&i.searchValue&&t.$apply(function(){e.searchValue=i.searchValue;e.populateCategorys(u.resultItemsPerPg,0,i.searchValue)})});$("#searchBar").on("searchClear",function(){t.$apply(function(){e.searchValue="";e.populateCategorys(u.resultItemsPerPg,0)})})}function t(n,t,i){var r=this;r.appProps=t;r.category=i.category;r.yes=function(){n.close(r.category);$("#glblWait").removeClass("hidden");i.save(i.category,function(){$("#glblWait").addClass("hidden")},!0)};r.no=function(){n.close()}}angular.module("app-mainmenu").controller("categoriesCtrlr",["$http","$scope","$sce","$uibModal","appProps","headerConfigService",n]);angular.module("app-mainmenu").controller("deleteCategoryInstanceCtrlr",["$uibModalInstance","appProps","param",t])})();