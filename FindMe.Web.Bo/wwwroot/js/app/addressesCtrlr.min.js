(function(){"use strict";function n(n,t,i,r,u,f){var e,s,w,b,k;$("[data-toggle=tooltip]").tooltip({trigger:"hover"});f.reset();f.title=u.lbl_Addresses;f.showToolBar=!0;f.showSearchCtrl=!0;f.showSaveBtn=!1;f.addBtnTltp=u.msg_AddAddr;f.refreshBtnTltp=u.msg_RfrshAddrs;f.saveBtnTltp=u.msg_SaveAddrs;e=this;e.appProps=u;e.clients=[];e.parentCategorys=[];e.categorys=[];e.cityDetails=[];e.tags=[];e.pgsCollection=[];e.currentPgNmbr=0;e.totalPgs=0;e.addressesCount=0;e.addressesCountMod=0;e.addresses=[];e.gotoPage=function(n,t){if(n&&!n.isActive&&!n.disabled){t;var i=u.resultItemsPerPg*n.index-1;i=i<0?0:i;e.currentPgNmbr=n.index;e.populateAddresses(u.resultItemsPerPg,i)}};var d=function(){var n,t,i;if(e.pgsCollection.length=0,e.totalPgs>1){for(n=e.currentPgNmbr-2,t=e.currentPgNmbr+2,n<0&&(t+=0-n,n=0),t>=e.totalPgs&&(t=e.totalPgs-1);t-n<4;)n--;for(n=n<0?0:n,e.pgsCollection.push({index:0,isActive:!1,text:"",icon:"fa fa-step-backward",disabled:e.currentPgNmbr<=0}),i=n;i<=t;i++)e.pgsCollection.push({index:i,isActive:e.currentPgNmbr===i,text:String(i+1),icon:"",disabled:!1});e.pgsCollection.push({index:e.totalPgs-1,isActive:!1,text:"",icon:"fa fa-step-forward",disabled:e.currentPgNmbr>=e.totalPgs-1})}},g=function(n){var i,t;if(n)for(Array.isArray(n)||(n=[n]),i=0;i<n.length;i++)t=n[i],t.__comp&&(!t.recordState||t.recordState<=0)&&(t.recordState=t.id>0?t.fromDate!==t.__comp.fromDate||t.toDate!==t.__comp.toDate||t.value!==t.__comp.value||t.clickCount!==t.__comp.clickCount?20:0:10)},o=function(n){var i,t;if(n)for(Array.isArray(n)||(n=[n]),i=0;i<n.length;i++)t=n[i],t.status=t.active?1:0,t.__comp&&(!t.recordState||t.recordState<=0)&&(t.recordState=t.id>0?t.desc!==t.__comp.desc||t.name!==t.__comp.name||t.isDefault!==t.__comp.isDefault||t.alt!==t.__comp.alt||t.active!==t.__comp.active||t.waitingUpload?20:0:10)},c=function(n){var r,t,i;if(n)for(Array.isArray(n)||(n=[n]),r=function(n){n&&(n.status=n.active?1:0,n.__comp&&(!n.recordState||n.recordState<=0)&&(n.recordState=n.id>0?n.hrFrom!==n.__comp.hrFrom||n.hrTo!==n.__comp.hrTo||n.minFrom!==n.__comp.minFrom||n.minTo!==n.__comp.minTo||n.active!==n.__comp.active?20:0:10))},t=0;t<n.length;t++)i=n[t],i.openHours?$.each(i.openHours,function(n,t){r(t)}):r(i)},l=function(n){n&&(n.status=n.active?1:0,n.__comp&&(!n.recordState||n.recordState<=0)&&(n.recordState=n.id>0?n.largeValue!==n.__comp.largeValue||n.smallValue!==n.__comp.smallValue?20:0:10))},a=function(n){var r,t,i;if(n)for(Array.isArray(n)||(n=[n]),r=function(n){n&&(n.status=n.active?1:0,n.__comp&&(!n.recordState||n.recordState<=0)&&(n.recordState=n.id>0?n.text!==n.__comp.text||n.link!==n.__comp.link||n.status!==n.__comp.status||n.active!==n.__comp.active?20:0:10))},t=0;t<n.length;t++)i=n[t],i.contacts?$.each(i.contacts,function(n,t){r(t)}):r(i)},v=function(n,t,i){n&&t&&(n.recordState=n.id>0?i?30:n.name!==t.name||n.slug!==t.slug||n.client_Id!==t.client_Id||n.cityDetail_Id!==t.cityDetail_Id||n.category_Id!==t.category_Id||n.latitude!==t.latitude||n.longitude!==t.longitude||n.desc_en!==t.desc_en||n.desc_fr!==t.desc_fr||n.flgRecByFbFans!==t.flgRecByFbFans||n.rateOverride!==t.rateOverride||n.rateOverrideCount!==t.rateOverrideCount||n.active!==t.active?20:0:10,g(n.ratingOverrides),o(n.images),o(n.logos),o(n.documents),c(n.openHours),l(n.tripAdWidget),a(n.contacts))},y=function(n){if(n){n.active=n.status===1;var t;e.clients.length>0&&(t=$.grep(e.clients,function(t){return t.id===n.client_Id}),t&&t.length>0&&(n.client=t[0]));e.categorys.length>0&&e.parentCategorys.length>0&&(t=$.grep(e.categorys,function(t){return t.id===n.category_Id}),t&&t.length>0?(n.parentCategory=t[0].parent,n.category=t[0]):(t=$.grep(e.parentCategorys,function(t){return t.id===n.category_Id}),t&&t.length>0&&(n.parentCategory=t[0],n.category=null)));e.cityDetails.length>0&&(t=$.grep(e.cityDetails,function(t){return t.id===n.cityDetail_Id}),t&&t.length>0&&(n.cityDetail=t[0]));n.__comp=jQuery.extend(!1,{},n)}},p=function(n){$("body").attr("style","overflow: hidden; position: fixed;");r.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"addressEditorModal.html",controller:"addressEditorInstanceCtrlr",controllerAs:"vm",size:"lg",appendTo:$("#addressesVw .modal-editor"),resolve:{param:function(){return{vmRoot:e,address:n,save:e.save,deleteModal:e.deleteModal,checkRecordState:v,revertAddress:w,checkFilesRecordState:o,checkOpenHoursRecordState:c,checkContactsRecordState:a,checkTripAdWidgetRecordState:l,clients:e.clients,parentCategorys:e.parentCategorys,categorys:e.categorys,cityDetails:e.cityDetails,tags:e.tags}}}})},h=function(n){n&&(n.ratingOverrides&&$.each(n.ratingOverrides,function(n,t){t.fromDate=new Date(t.fromUtc);t.toDate=t.toUtc?new Date(t.toUtc):null;t.__comp=jQuery.extend(!1,{},t)}),n.tags&&$.each(n.tags,function(n,t){t.name=u.currentLang.startsWith("en")?t.name_en:t.name_fr}),n.images&&$.each(n.images,function(n,t){t.active=t.status===1;t.__comp=jQuery.extend(!1,{},t)}),n.logos&&$.each(n.logos,function(n,t){t.active=t.status===1;t.__comp=jQuery.extend(!1,{},t)}),n.documents&&$.each(n.documents,function(n,t){t.active=t.status===1;t.__comp=jQuery.extend(!1,{},t)}),n.openHours&&$.each(n.openHours,function(n,t){switch(t.day){case 10:t.name=u.lbl_Monday;break;case 20:t.name=u.lbl_Tuesday;break;case 30:t.name=u.lbl_Wednesday;break;case 40:t.name=u.lbl_Thursday;break;case 50:t.name=u.lbl_Friday;break;case 60:t.name=u.lbl_Saturday;break;case 70:t.name=u.lbl_Sunday;break;case 80:t.name=u.lbl_pHoliday}$.each(t.openHours,function(n,t){t.timeFrom=new Date(2e3,10,10,t.hrFrom,t.minFrom);t.timeTo=new Date(2e3,10,10,t.hrTo,t.minTo);t.active=t.status===1;t.__comp=jQuery.extend(!1,{},t)})}),n.contacts&&$.each(n.contacts,function(n,t){$.each(t.contacts,function(n,i){i.name=t.name;i.active=i.status===1;i.__comp=jQuery.extend(!1,{},i)})}),n.descs&&($.each(n.descs,function(t,i){if(i&&i.lang_Code){var r=i.lang_Code.toLowerCase();r.startsWith("en")?n.desc_en=i.value:r.startsWith("fr")&&(n.desc_fr=i.value)}}),n.__comp&&(n.__comp.desc_en=n.desc_en,n.__comp.desc_fr=n.desc_fr),delete n.descs),n.tripAdWidget||(n.tripAdWidget={id:0,largeValue:"",smallValue:"",recordState:0,status:1}),n.tripAdWidget.__comp=jQuery.extend(!1,{},n.tripAdWidget),n.tripAdWidget.trustLargeValue=function(){return i.trustAsHtml(n.tripAdWidget.largeValue)},n.tripAdWidget.trustSmallValue=function(){return i.trustAsHtml(n.tripAdWidget.smallValue)})},nt=function(n){if(n){var r,t,i;if(n.ratingOverrides)for(r=n.ratingOverrides,n.ratingOverrides=[],t=0;t<r.length;t++)i=jQuery.extend(!0,{},r[t]),delete i.__comp,n.ratingOverrides.push(i);if(n.tags)for(r=n.tags,n.tags=[],t=0;t<r.length;t++)i=jQuery.extend(!0,{},r[t]),delete i.__comp,n.tags.push(i);if(n.images)for(r=n.images,n.images=[],t=0;t<r.length;t++)i=jQuery.extend(!0,{},r[t]),delete i.__comp,n.images.push(i);if(n.logos)for(r=n.logos,n.logos=[],t=0;t<r.length;t++)i=jQuery.extend(!0,{},r[t]),delete i.__comp,n.logos.push(i);if(n.documents)for(r=n.documents,n.documents=[],t=0;t<r.length;t++)i=jQuery.extend(!0,{},r[t]),delete i.__comp,n.documents.push(i);if(n.openHours)for(r=n.openHours,n.openHours=[],t=0;t<r.length;t++)i=jQuery.extend(!0,{},r[t]),delete i.__comp,n.openHours.push(i);if(n.contacts)for(r=n.contacts,n.contacts=[],t=0;t<r.length;t++)i=jQuery.extend(!0,{},r[t]),delete i.__comp,$.each(i.contacts,function(){delete this.__comp}),n.contacts.push(i);n.tripAdWidget&&(n.tripAdWidget=jQuery.extend(!0,{},n.tripAdWidget),delete n.tripAdWidget.__comp,delete n.tripAdWidget.trustLargeValue,delete n.tripAdWidget.trustSmallValue)}return n};e.goInEditMode=function(t){if(t)if(t.hasContent||t.id<=0)p(t);else{var i=function(n){n.data&&n.data.result&&(jQuery.extend(t,n.data.result),t.hasContent=!0,h(t),p(t))},r=function(n){n.data&&checkRedirectForSignIn(n.data)&&(e.errorstatus=n.status+" - "+n.statusText,e.errormsg=n.data.msg,e.errorid=n.data.id,e.showError=!0)},f=function(){t.gettingContent=!1};t.gettingContent=!0;n.post(u.urlGetAddressContent,{addrID:t.id}).then(i,r).finally(f)}};e.deleteModal=function(n){n&&(n.id>0?r.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"deleteAddressModal.html",controller:"deleteAddressInstanceCtrlr",controllerAs:"vm",size:"lg",appendTo:$("#addressesVw .modal-container"),resolve:{param:function(){return{address:n,save:e.save}}}}):e.addresses.remove(n))};s="";e.populateAddresses=function(t,i,r){var f=!1;f=r||s?r!==s||e.addressesCountMod!==0:e.addressesCountMod!==0;s=r;e.showError=!1;e.errorstatus="";e.errormsg="";e.errorid=0;t=t?t:u.resultItemsPerPg;i=i?i:0;r=r?r:e.searchValue;var o=function(n){var i,t,r;if(e.addresses.length=0,n.data&&((n.data.count>0||n.data.count===0&&n.data.result&&n.data.result.length===0)&&(e.addressesCountMod=0,e.addressesCount=n.data.count,i=parseInt(e.addressesCount/u.resultItemsPerPg),i+=e.addressesCount%u.resultItemsPerPg>0?1:0,e.totalPgs=i),d(),n.data.clients&&n.data.clients.length>0&&(e.clients.length=0,$.each(n.data.clients,function(n,t){t.name=t.legalName?t.legalName.encodeHtml():(t.civility?t.civility.toUpperCase()+" ":"")+(t.lName===null?"":t.lName.toUpperCase()+(t.fName?", ":""))+(t.fName?t.fName:"").encodeHtml();e.clients.push(t)})),n.data.categorys&&n.data.categorys.length>0&&(e.parentCategorys.length=0,e.categorys.length=0,$.each(n.data.categorys,function(n,t){t.name=t.name.encodeHtml();e.parentCategorys.push(t);t.children&&t.children.length>0&&$.each(t.children,function(n,i){i.parent=t;i.name=i.name.encodeHtml();e.categorys.push(i)})})),n.data.cityDetails&&n.data.cityDetails.length>0&&(e.cityDetails.length=0,$.each(n.data.cityDetails,function(n,t){t.name=t.name.encodeHtml();e.cityDetails.push(t)})),n.data.result))for(t=0;t<n.data.result.length;t++)r=n.data.result[t],y(r),e.addresses.push(r)},h=function(n){n.data&&checkRedirectForSignIn(n.data)&&(e.errorstatus=n.status+" - "+n.statusText,e.errormsg=n.data.msg,e.errorid=n.data.id,e.showError=!0)},c=function(){toggleGlblWaitVisibility(!1)};toggleGlblWaitVisibility(!0);n.post(u.urlGetAddresses,{limit:t,offset:i,getTotalAddresses:e.addressesCount<=0||f,name:r?r:null,getRefClients:e.clients.length===0,getRefCatgs:e.categorys.length===0,getRefCities:e.cityDetails.length===0}).then(o,h).finally(c)};w=function(n){if(n&&n.__comp)if(n.id>0){var t=n.__comp;n.name=t.name;n.slug=t.slug;n.client_Id=t.client_Id;n.client=t.client;n.cityDetail_Id=t.cityDetail_Id;n.cityDetail=t.cityDetail;n.category_Id=t.category_Id;n.parentCategory=t.parentCategory;n.category=t.category;n.latitude=t.latitude;n.longitude=t.longitude;n.desc_en=t.desc_en;n.desc_fr=t.desc_fr;n.flgRecByFbFans=t.flgRecByFbFans;n.rateOverride=t.rateOverride;n.rateOverrideCount=t.rateOverrideCount;n.status=t.status;n.active=t.active;n.inEditMode=!1}else e.addresses.remove(n)};b=function(t,i){var r,f;if(t){Array.isArray(t)||(t=[t]);var c=!1,v=function(n){if(c=!0,n&&n.data&&n.data.result)for(r=0;r<n.data.result.length;r++){var t=n.data.result[r],i=$.grep(e.addresses,function(n){return n.uid===t.uid})[0];if(i){if(h(t),i.images&&t.images&&t.images.length>0)for(i.images.length=0,r=0;r<t.images.length;r++)i.images.push(t.images[r]);if(i.logos&&t.logos&&t.logos.length>0)for(i.logos.length=0,r=0;r<t.logos.length;r++)i.logos.push(t.logos[r]);if(i.documents&&t.documents&&t.documents.length>0)for(i.documents.length=0,r=0;r<t.documents.length;r++)i.documents.push(t.documents[r])}}},y=function(n){n.data&&checkRedirectForSignIn(n.data)&&(e.errorstatus=n.status+" - "+n.statusText,e.errormsg=n.data.msg,e.errorid=n.data.id,e.showError=!0)},l=function(){for(var n=0;n<t.length;n++)t[n].toBeUploadedFiles=[];toggleGlblWaitVisibility(!1);i&&i(c)},s=new FormData,a=!1;for(r=0;r<t.length;r++)f=t[r],f.toBeUploadedFiles&&(s.append("address",JSON.stringify({id:f.id,uid:f.uid,clientUID:f.clientUID})),$.each(f.toBeUploadedFiles,function(n,t){if(!t.recordState||t.recordState!==30){a=!0;var i=f.uid+"|"+t.value.type+"|"+n;s.append(i,t.file);o(t.value);s.append(i,JSON.stringify(t.value))}}));a?n.post(u.urlUploadAddressFiles,s,{transformRequest:angular.identity,headers:{"Content-Type":undefined}}).then(v,y).finally(l):(c=!0,l())}};e.save=function(t,i,r){var c,s,f;if(t){Array.isArray(t)||(t=[t]);r&&!Array.isArray(r)&&(r=[r]);var o=[],l=[],p=r&&r.length===t.length;for(c=0;c<t.length;c++)s=t[c],s&&s.__comp&&(f=nt(jQuery.extend(!1,{},s)),delete f.__comp,f.status=f.active?1:0,f.client_Id=f.client?f.client.id:0,delete f.client,f.category_Id=f.category?f.category.id:f.parentCategory?f.parentCategory.id:0,delete f.parentCategory,delete f.category,f.cityDetail_Id=f.cityDetail?f.cityDetail.id:0,delete f.cityDetail,v(f,s.__comp,p?r[c]:!1),f.status=f.active?1:0,f.ratingOverrides&&$.each(f.ratingOverrides,function(n,t){t.fromUtc=u.swIsoFormat(t.fromDate,!0);t.toUtc=u.swIsoFormat(t.toDate,!0);delete t.fromDate;delete t.toDate}),l.push(f),o.push(s));if(o.length>0){var a=!1,w=function(n){n.data&&n.data.result&&n.data.result.length>0&&(o.length===n.data.result.length&&$.each(n.data.result,function(n,t){var i=o[n],r;if(t&&t.address){if(i.id=t.address.id,i.name=t.address.name,i.slug=t.address.slug,i.client_Id=t.address.client_Id,i.cityDetail_Id=t.address.cityDetail_Id,i.category_Id=t.address.category_Id,i.latitude=t.address.latitude,i.longitude=t.address.longitude,i.flgRecByFbFans=t.address.flgRecByFbFans,i.rateOverride=t.address.rateOverride,i.rateOverrideCount=t.address.rateOverrideCount,i.rate=t.address.rate,i.rateCount=t.address.rateCount,i.status=t.address.status,i.active=i.status===1,y(i),h(t),i.desc_en=t.desc_en,i.desc_fr=t.desc_fr,t.ratingOverrides&&i.ratingOverrides)for(i.ratingOverrides.length=0,r=0;r<t.ratingOverrides.length;r++)i.ratingOverrides.push(t.ratingOverrides[r]);if(t.tags&&i.tags)for(i.tags.length=0,r=0;r<t.tags.length;r++)i.tags.push(t.tags[r]);if(t.images&&i.images)for(i.images.length=0,r=0;r<t.images.length;r++)i.images.push(t.images[r]);if(t.logos&&i.logos)for(i.logos.length=0,r=0;r<t.logos.length;r++)i.logos.push(t.logos[r]);if(t.documents&&i.documents)for(i.documents.length=0,r=0;r<t.documents.length;r++)i.documents.push(t.documents[r]);if(t.openHours&&i.openHours)for(i.openHours.length=0,r=0;r<t.openHours.length;r++)i.openHours.push(t.openHours[r]);if(t.contacts&&i.contacts)for(i.contacts.length=0,r=0;r<t.contacts.length;r++)i.contacts.push(t.contacts[r]);i.tripAdWidget&&(t.tripAdWidget?(i.tripAdWidget.status=t.tripAdWidget.status,i.tripAdWidget.uid=t.tripAdWidget.uid,i.tripAdWidget.id=t.tripAdWidget.id,i.tripAdWidget.largeValue=t.tripAdWidget.largeValue,i.tripAdWidget.smallValue=t.tripAdWidget.smallValue):(i.tripAdWidget.status=1,i.tripAdWidget.uid=null,i.tripAdWidget.id=0,i.tripAdWidget.largeValue=null,i.tripAdWidget.smallValue=null),i.tripAdWidget.recordState=0);l[n].recordState===10&&(e.addressesCountMod+=1,(!e.totalPgs||e.totalPgs<=0)&&(e.totalPgs=1));delete i.status;delete i.recordState;i.__comp=t}else e.addresses.remove(i),e.addressesCountMod-=1,e.addressesCount+e.addressesCountMod<=0&&(e.totalPgs=0)}),a=!0)},k=function(n){n.data&&checkRedirectForSignIn(n.data)&&(e.errorstatus=n.status+" - "+n.statusText,e.errormsg=n.data.msg,e.errorid=n.data.id,e.showError=!0)},d=function(){a&&o.length>0?b(o,i):(toggleGlblWaitVisibility(!1),i&&i(a))};e.showError=!1;e.errorstatus="";e.errormsg="";e.errorid=0;toggleGlblWaitVisibility(!0);n.post(u.urlSaveAddresses,{addresses:l}).then(w,k).finally(d)}}};k=function(){var i=$(this),n,r;i.hasClass("refresh")?(n=$.grep(e.pgsCollection,function(n){return n.isActive}),n&&Array.isArray(n)&&(n=n.length>0?n[0]:null),n&&(r=u.resultItemsPerPg*n.index-1,t.$apply(function(){e.populateAddresses(u.resultItemsPerPg,r)}))):i.hasClass("add")&&t.$apply(function(){var n={id:0,name:"",slug:"",client_Id:0,client:null,cityDetail_Id:0,cityDetail:null,category_Id:0,parentCategory:null,category:null,latitude:0,longitude:0,flgRecByFbFans:!1,rateOverride:0,rateOverrideCount:0,rate:0,rateCount:0,status:1,active:!0,recordState:10};n.__comp=jQuery.extend(!0,{},n);n.inEditMode=!0;n.saving=!1;e.addresses.insert(0,n);e.goInEditMode(n)})};$("#searchBar .btn.btn-tb").on("click",k);$("#searchBar").on("searchGo",function(n,i){i&&i.searchValue&&t.$apply(function(){e.searchValue=i.searchValue;e.populateAddresses(u.resultItemsPerPg,0,i.searchValue)})});$("#searchBar").on("searchClear",function(){t.$apply(function(){e.searchValue="";e.populateAddresses(u.resultItemsPerPg,0)})})}function t(n,t,i,r,u,f){var e=this,o;e.appProps=u;e.vmRoot=f.vmRoot;e.address=f.address;e.clients=f.clients;e.parentCategorys=f.parentCategorys;e.categorys=f.categorys;e.cityDetails=f.cityDetails;e.tags=f.tags;e.checkFilesRecordState=f.checkFilesRecordState;e.checkOpenHoursRecordState=f.checkOpenHoursRecordState;e.checkContactsRecordState=f.checkContactsRecordState;e.checkTripAdWidget=function(n){n&&(n.largeValue&&(n.largeValue=n.largeValue.replaceAll('"',"'")),n.smallValue&&(n.smallValue=n.smallValue.replaceAll('"',"'")),f.checkTripAdWidgetRecordState(n))};e.tagFilter="";t.$watch("vm.tagFilter",function(n){var i,t,r;if(e.tags&&e.tags.length>0)if(n&&n.length>0)for(r=String(accentFold(n)).toLowerCase(),t=0;t<e.tags.length;t++)i=e.tags[t],i.isFilteredOut=String(accentFold(i.name)).toLowerCase().indexOf(r)<0;else for(t=0;t<e.tags.length;t++)i=e.tags[t],i.isFilteredOut=!1});e.selectedTagCount=0;e.tripadCode=!0;e.tripadPreview=!1;e.selectTag=function(n){n&&(n.isSelected?(n.isSelected=!1,e.selectedTagCount>0&&e.selectedTagCount--):(n.isSelected=!0,e.selectedTagCount++))};e.showAddTags=!1;e.gettingAddTags=!1;e.applyTags=function(){var n,t;if(e.tags&&e.tags.length>0)for(n=0;n<e.tags.length;n++)t=e.tags[n],t.isSelected&&e.address.tags.insert(0,{recordState:10,id:t.id,address_Id:e.address.id,name:t.name,active:!0,status:1});e.showAddTags=!1};e.addressTagClick=function(n){if(n)switch(n.recordState){case 30:n.recordState=0;break;case 10:n.recordState=0;e.address.tags.remove(n);break;default:n.recordState=30}};e.openAddTags=function(){var i,t;if(e.selectedTagCount=0,e.showAddTags=!0,e.tags&&e.tags.length>0)for(i=0;i<e.tags.length;i++)t=e.tags[i],t.isSelected=!1,t.isFilteredOut=!1,t.isVisible=!0,$.grep(e.address.tags,function(n){return n.id===t.id}).length>0&&(t.isVisible=!1);else{e.gettingAddTags=!0;var r=function(n){var i,t;if(e.tags.length=0,n.data&&n.data.result)for(i=0;i<n.data.result.length;i++)t=n.data.result[i],t.name=u.currentLang.startsWith("en")?t.name_en:t.name_fr,t.isSelected=!1,t.isFilteredOut=!1,t.isVisible=!0,$.grep(e.address.tags,function(n){return n.id===t.id}).length>0&&(t.isVisible=!1),e.tags.push(t)},f=function(n){n.data&&checkRedirectForSignIn(n.data)&&(e.errorstatus=n.status+" - "+n.statusText,e.errormsg=n.data.msg,e.errorid=n.data.id,e.showError=!0)},o=function(){e.gettingAddTags=!1};n.post(u.urlGetTags,{}).then(r,f).finally(o)}$("#addressesVw .modal-editor .modal-dialog .modal-content .add-tags-bg .add-tags-container .form-group .form-control input").on("focusin focusout",function(){var n=$($(this).parent());n&&n.length>0&&n.toggleClass("has-focus")})};o=function(n){n&&e.address&&e.address.toBeUploadedFiles&&e.address.toBeUploadedFiles.length>0&&$.each($.grep(e.address.toBeUploadedFiles,function(t){return t.value===n}),function(n,t){e.address.toBeUploadedFiles.remove(t)})};e.revertFile=function(n){n&&n.__comp&&(n.name=n.__comp.name,n.isDefault=n.__comp.isDefault,n.format=n.__comp.format,n.alt=n.__comp.alt,n.desc=n.__comp.desc,n.active=n.__comp.active,n.recordState=0,n.waitingUpload=!1,o(n))};e.uploadImgClick=function(n,i){if(i)if(i.waitingUpload)i.name=i.__comp.name,i.format=i.__comp.format,i.waitingUpload=!1,i.recordState=i.recordStateBeforeUpload?i.recordStateBeforeUpload:0,o(i);else if(n&&n.currentTarget){var r=$(n.currentTarget).siblings('input[type="file"]');if(r&&r.length>0){r.off("change");r.on("change",function(){t.$apply(function(){var n,t,u;e.address&&(e.address.toBeUploadedFiles||(e.address.toBeUploadedFiles=[]),n=r.get(0).files,n&&n.length>0&&($.each(n,function(n,t){var u=null,r=null;t.name&&(r=t.name.split("."),r&&r.length>0?(u=String(r[0]).toLowerCase(),r=String(r[r.length-1]).toLowerCase()):(u=null,r=null));i.name=u;i.format=r;e.address.toBeUploadedFiles.push({file:t,key:t.name+"_"+n+"_KEY",value:i})}),t=r.parents("tr").first().find("td img.local"),t&&t.length>0&&(u=new FileReader,u.onload=function(n){t.attr("src",n.target.result)},u.readAsDataURL(n[0]))),i.waitingUpload=!0,i.recordStateBeforeUpload=i.recordState,e.checkFilesRecordState(i))})});r.first().click()}}};e.fileSetToDefault=function(n,t){n&&t&&t.length>0&&($.each($.grep(t,function(n){return n.isDefault===!0}),function(n,t){t.isDefault=!1}),n.isDefault=!0);e.checkFilesRecordState(n)};e.revertContact=function(n){n&&n.__comp&&(n.text=n.__comp.text,n.link=n.__comp.link,n.status=n.__comp.status,n.active=n.__comp.active,n.recordState=0);e.checkContactsRecordState(n)};e.contactValueChanged=function(n){e.checkContactsRecordState(n)};e.revertDayRow=function(n){n&&n.__comp&&(n.timeFrom=n.__comp.timeFrom,n.timeTo=n.__comp.timeTo,n.hrFrom=n.__comp.hrFrom,n.hrTo=n.__comp.hrTo,n.minFrom=n.__comp.minFrom,n.minTo=n.__comp.minTo,n.active=n.__comp.active,n.recordState=0,n.waitingUpload=!1);e.checkOpenHoursRecordState(n)};e.timeFromChanged=function(n){n&&(n.timeFrom?(n.hrFrom=n.timeFrom.getHours(),n.minFrom=n.timeFrom.getMinutes()):(n.hrFrom=0,n.minFrom=0));e.checkOpenHoursRecordState(n)};e.timeToChanged=function(n){n&&(n.timeTo?(n.hrTo=n.timeTo.getHours(),n.minTo=n.timeTo.getMinutes()):(n.hrTo=0,n.minTo=0))};e.revertTripAd=function(){e.address&&e.address.tripAdWidget&&e.address.tripAdWidget.__comp&&(e.address.tripAdWidget.smallValue=e.address.tripAdWidget.__comp.smallValue,e.address.tripAdWidget.largeValue=e.address.tripAdWidget.__comp.largeValue,e.address.tripAdWidget.recordState=0)};e.deleteTripAd=function(){e.address&&e.address.tripAdWidget&&(e.address.tripAdWidget.smallValue=null,e.address.tripAdWidget.largeValue=null,e.address.tripAdWidget.recordState=e.address.tripAdWidget.recordState&&e.address.tripAdWidget.recordState===10?0:30)};e.save=function(){f.save(e.address)};e.close=function(){e.address&&(e.address.id>0?f.revertAddress(e.address):f.deleteModal(e.address));r.close()};e.addRatingOverride=function(){var n={id:0,fromUtc:null,fromDate:new Date,toUtc:null,toDate:null,value:0,clickCount:0,status:1,recordState:10,active:!0};e.address.ratingOverrides.insert(0,n)};e.addLogo=function(){var n={recordState:10,id:0,type:50,isDefault:$.grep(e.address.logos,function(n){return n.isDefault===!0}).length<=0,uid:null,alt:null,desc:null,status:1,active:!0};e.address.logos.insert(0,n)};e.addImage=function(){var n={recordState:10,id:0,type:10,isDefault:$.grep(e.address.images,function(n){return n.isDefault===!0}).length<=0,uid:null,alt:null,desc:null,status:1,active:!0};e.address.images.insert(0,n)};e.addDoc=function(){var n={recordState:10,id:0,type:0,isDefault:$.grep(e.address.documents,function(n){return n.isDefault===!0}).length<=0,uid:null,alt:null,desc:null,status:1,active:!0};e.address.documents.insert(0,n)};e.addOpenHours=function(n){if(n&&n.openHours)n.openHours.insert(0,{recordState:10,id:0,hrFrom:null,hrTo:null,minFrom:null,minTo:null,status:1,active:!0})};e.addContact=function(n){if(n&&n.contacts){var t={recordState:10,id:0,name:n.name,link:null,text:null,status:1,active:!0};n.contacts.insert(0,t)}};e.markRowForDeletion=function(n,t){n&&t&&(n.recordState===10?t.remove(n):n.recordState===30?n.recordState=n.recordStateBeforeDelete:(n.recordStateBeforeDelete=n.recordState,n.recordState=30))};e.setRatingToDelete=function(n){n&&(n.recordState===10?e.address.ratingOverrides.remove(n):(n.prevRecordState=n.recordState,n.recordState=30))};r.closed.then(function(){$("body").attr("style","")})}function i(n,t,i){var r=this;r.appProps=t;r.address=i.address;r.yes=function(){n.close(r.address);toggleGlblWaitVisibility(!0);i.save(i.address,function(){toggleGlblWaitVisibility(!1)},!0)};r.no=function(){n.close()}}angular.module("app-mainmenu").controller("addressesCtrlr",["$http","$scope","$sce","$uibModal","appProps","headerConfigService",n]);angular.module("app-mainmenu").controller("addressEditorInstanceCtrlr",["$http","$scope","$sce","$uibModalInstance","appProps","param",t]);angular.module("app-mainmenu").controller("deleteAddressInstanceCtrlr",["$uibModalInstance","appProps","param",i])})();