(function(){"use strict";function n(n,t,i,r,u,f,e){var o,s,c,g,nt,tt;$("[data-toggle=tooltip]").tooltip({trigger:"hover"});e.reset();e.title=f.lbl_Addresses;e.showToolBar=!0;e.showSearchCtrl=!0;e.showSaveBtn=!1;e.addBtnTltp=f.msg_AddAddr;e.refreshBtnTltp=f.msg_RfrshAddrs;e.saveBtnTltp=f.msg_SaveAddrs;o=this;s=!1;o.appProps=f;o.clients=[];o.parentCategorys=[];o.categorys=[];o.cityDetails=[];o.tags=[];o.featuredTypes=[{value:10,name:f.lbl_HmPg.encodeHtml()},{value:20,name:f.lbl_MenuAndSrchLstSide.encodeHtml()}];o.pgsCollection=[];o.currentPgNmbr=0;o.totalPgs=0;o.addressesCount=0;o.addressesCountMod=0;o.addresses=[];o.gotoPage=function(n,t){if(n&&!n.isActive&&!n.disabled){t;var i=f.resultItemsPerPg*n.index-1;i=i<0?0:i;o.currentPgNmbr=n.index;o.populateAddresses(null,f.resultItemsPerPg,i)}};var it=function(){var n,t,i;if(o.pgsCollection.length=0,o.totalPgs>1){for(n=o.currentPgNmbr-2,t=o.currentPgNmbr+2,n<0&&(t+=0-n,n=0),t>=o.totalPgs&&(t=o.totalPgs-1);t-n<4;)n--;for(n=n<0?0:n,o.pgsCollection.push({index:0,isActive:!1,text:"",icon:"fa fa-step-backward",disabled:o.currentPgNmbr<=0}),i=n;i<=t;i++)o.pgsCollection.push({index:i,isActive:o.currentPgNmbr===i,text:String(i+1),icon:"",disabled:!1});o.pgsCollection.push({index:o.totalPgs-1,isActive:!1,text:"",icon:"fa fa-step-forward",disabled:o.currentPgNmbr>=o.totalPgs-1})}},rt=function(n){var i,t;if(n)for(Array.isArray(n)||(n=[n]),i=0;i<n.length;i++)t=n[i],t.__comp&&(!t.recordState||t.recordState<=0)&&(t.recordState=t.id>0?t.fromDate!==t.__comp.fromDate||t.toDate!==t.__comp.toDate||t.value!==t.__comp.value||t.clickCount!==t.__comp.clickCount?20:0:10)},h=function(n){var i,t;if(n)for(Array.isArray(n)||(n=[n]),i=0;i<n.length;i++)t=n[i],t.status=t.active?1:0,t.__comp&&(!t.recordState||t.recordState<=0)&&(t.recordState=t.id>0?t.desc!==t.__comp.desc||t.name!==t.__comp.name||t.isDefault!==t.__comp.isDefault||t.alt!==t.__comp.alt||t.active!==t.__comp.active||t.waitingUpload?20:0:10)},a=function(n){var r,t,i;if(n)for(Array.isArray(n)||(n=[n]),r=function(n){n&&(n.status=n.active?1:0,n.__comp&&(!n.recordState||n.recordState<=0)&&(n.recordState=n.id>0?n.hrFrom!==n.__comp.hrFrom||n.hrTo!==n.__comp.hrTo||n.minFrom!==n.__comp.minFrom||n.minTo!==n.__comp.minTo||n.active!==n.__comp.active?20:0:10))},t=0;t<n.length;t++)i=n[t],i.openHours?$.each(i.openHours,function(n,t){r(t)}):r(i)},v=function(n){n&&(n.status=n.active?1:0,n.__comp&&(!n.recordState||n.recordState<=0)&&(n.recordState=n.id>0?n.largeValue!==n.__comp.largeValue||n.smallValue!==n.__comp.smallValue?20:0:10))},y=function(n){var r,t,i;if(n)for(Array.isArray(n)||(n=[n]),r=function(n){n&&(n.status=n.active?1:0,n.__comp&&(!n.recordState||n.recordState<=0)&&(n.recordState=n.id>0?n.text!==n.__comp.text||n.link!==n.__comp.link||n.status!==n.__comp.status||n.active!==n.__comp.active?20:0:10))},t=0;t<n.length;t++)i=n[t],i.contacts?$.each(i.contacts,function(n,t){r(t)}):r(i)},p=function(n){var i,t;if(n)for(Array.isArray(n)||(n=[n]),i=0;i<n.length;i++)t=n[i],t.__comp&&(!t.recordState||t.recordState<=0)&&(t.recordState=t.id>0?t.fromDate!==t.__comp.fromDate||t.toDate!==t.__comp.toDate||t.type!==t.__comp.type||t.fromUtc!==t.__comp.fromUtc||t.toUtc!==t.__comp.toUtc?20:0:10)},w=function(n){var i,t;if(n)for(Array.isArray(n)||(n=[n]),i=0;i<n.length;i++)t=n[i],t.__comp&&(!t.recordState||t.recordState<=0)&&(t.recordState=t.id>0?t.fromDate!==t.__comp.fromDate||t.toDate!==t.__comp.toDate||t.fromUtc!==t.__comp.fromUtc||t.toUtc!==t.__comp.toUtc||t.webUrl!==t.__comp.webUrl||t.name!==t.__comp.name?20:0:10)},b=function(n,t,i){n&&t&&(n.recordState=n.id>0?i?30:n.name!==t.name||n.slug!==t.slug||n.client_Id!==t.client_Id||n.cityDetail_Id!==t.cityDetail_Id||n.category_Id!==t.category_Id||n.latitude!==t.latitude||n.longitude!==t.longitude||n.desc_en!==t.desc_en||n.desc_fr!==t.desc_fr||n.flgRecByFbFans!==t.flgRecByFbFans||n.rateOverride!==t.rateOverride||n.rateOverrideCount!==t.rateOverrideCount||n.active!==t.active?20:0:10,rt(n.ratingOverrides),h(n.images),h(n.logos),h(n.documents),a(n.openHours),v(n.tripAdWidget),y(n.contacts),p(n.featureds),w(n.featureds))},k=function(n){if(n){n.active=n.status===1;var t;o.clients.length>0&&(t=$.grep(o.clients,function(t){return t.id===n.client_Id}),t&&t.length>0&&(n.client=t[0]));o.categorys.length>0&&o.parentCategorys.length>0&&(t=$.grep(o.categorys,function(t){return t.id===n.category_Id}),t&&t.length>0?(n.parentCategory=t[0].parent,n.category=t[0]):(t=$.grep(o.parentCategorys,function(t){return t.id===n.category_Id}),t&&t.length>0&&(n.parentCategory=t[0],n.category=null)));o.cityDetails.length>0&&(t=$.grep(o.cityDetails,function(t){return t.id===n.cityDetail_Id}),t&&t.length>0&&(n.cityDetail=t[0]));n.__comp=jQuery.extend(!1,{},n)}},d=function(n){$("body").attr("style","overflow: hidden; position: fixed;");u.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"addressEditorModal.html",controller:"addressEditorInstanceCtrlr",controllerAs:"vm",size:"lg",appendTo:$("#addressesVw .modal-editor"),resolve:{param:function(){return{vmRoot:o,address:n,save:o.save,deleteModal:o.deleteModal,checkRecordState:b,revertAddress:g,checkFilesRecordState:h,checkOpenHoursRecordState:a,checkContactsRecordState:y,checkTripAdWidgetRecordState:v,checkFeaturedsRecordState:p,checkYoutubeLinksRecordState:w,clients:o.clients,parentCategorys:o.parentCategorys,categorys:o.categorys,cityDetails:o.cityDetails,tags:o.tags,featuredTypes:o.featuredTypes}}}})},l=function(n){n&&(n.ratingOverrides&&$.each(n.ratingOverrides,function(n,t){t.fromDate=new Date(t.fromUtc);t.toDate=t.toUtc?new Date(t.toUtc):null;t.__comp=jQuery.extend(!1,{},t)}),n.tags&&$.each(n.tags,function(n,t){t.name=f.currentLang.startsWith("en")?t.name_en:t.name_fr}),n.images&&$.each(n.images,function(n,t){t.active=t.status===1;t.__comp=jQuery.extend(!1,{},t)}),n.logos&&$.each(n.logos,function(n,t){t.active=t.status===1;t.__comp=jQuery.extend(!1,{},t)}),n.documents&&$.each(n.documents,function(n,t){t.active=t.status===1;t.__comp=jQuery.extend(!1,{},t)}),n.openHours&&$.each(n.openHours,function(n,t){switch(t.day){case 20:t.name=f.lbl_Monday;break;case 30:t.name=f.lbl_Tuesday;break;case 40:t.name=f.lbl_Wednesday;break;case 50:t.name=f.lbl_Thursday;break;case 60:t.name=f.lbl_Friday;break;case 70:t.name=f.lbl_Saturday;break;case 10:t.name=f.lbl_Sunday;break;case 80:t.name=f.lbl_pHoliday}$.each(t.openHours,function(n,t){t.timeFrom=new Date(2e3,10,10,t.hrFrom,t.minFrom);t.timeTo=new Date(2e3,10,10,t.hrTo,t.minTo);t.active=t.status===1;t.__comp=jQuery.extend(!1,{},t)})}),n.contacts&&$.each(n.contacts,function(n,t){$.each(t.contacts,function(n,i){i.name=t.name;i.active=i.status===1;i.__comp=jQuery.extend(!1,{},i)})}),n.descs&&($.each(n.descs,function(t,i){if(i&&i.lang_Code){var r=i.lang_Code.toLowerCase();r.startsWith("en")?n.desc_en=i.value:r.startsWith("fr")&&(n.desc_fr=i.value)}}),n.__comp&&(n.__comp.desc_en=n.desc_en,n.__comp.desc_fr=n.desc_fr),delete n.descs),n.featureds&&$.each(n.featureds,function(n,t){t.fromDate=new Date(t.fromUtc);t.toDate=t.toUtc?new Date(t.toUtc):null;var i=$.grep(o.featuredTypes,function(n){return n.value===t.type});t.typeObj=i.length>0?i[0]:null;t.__comp=jQuery.extend(!1,{},t)}),n.youtubeLinks&&$.each(n.youtubeLinks,function(n,t){t.fromDate=new Date(t.fromUtc);t.toDate=t.toUtc?new Date(t.toUtc):null;t.active=t.status===1;t.__comp=jQuery.extend(!1,{},t)}),n.tripAdWidget||(n.tripAdWidget={id:0,largeValue:"",smallValue:"",recordState:0,status:1}),n.tripAdWidget.__comp=jQuery.extend(!1,{},n.tripAdWidget),n.tripAdWidget.trustLargeValue=function(){return r.trustAsHtml(n.tripAdWidget.largeValue)},n.tripAdWidget.trustSmallValue=function(){return r.trustAsHtml(n.tripAdWidget.smallValue)})},ut=function(n){if(n){var r,t,i;if(n.ratingOverrides)for(r=n.ratingOverrides,n.ratingOverrides=[],t=0;t<r.length;t++)i=jQuery.extend(!0,{},r[t]),delete i.__comp,n.ratingOverrides.push(i);if(n.tags)for(r=n.tags,n.tags=[],t=0;t<r.length;t++)i=jQuery.extend(!0,{},r[t]),delete i.__comp,n.tags.push(i);if(n.images)for(r=n.images,n.images=[],t=0;t<r.length;t++)i=jQuery.extend(!0,{},r[t]),delete i.__comp,n.images.push(i);if(n.logos)for(r=n.logos,n.logos=[],t=0;t<r.length;t++)i=jQuery.extend(!0,{},r[t]),delete i.__comp,n.logos.push(i);if(n.documents)for(r=n.documents,n.documents=[],t=0;t<r.length;t++)i=jQuery.extend(!0,{},r[t]),delete i.__comp,n.documents.push(i);if(n.openHours)for(r=n.openHours,n.openHours=[],t=0;t<r.length;t++)i=jQuery.extend(!0,{},r[t]),delete i.__comp,n.openHours.push(i);if(n.contacts)for(r=n.contacts,n.contacts=[],t=0;t<r.length;t++)i=jQuery.extend(!0,{},r[t]),delete i.__comp,$.each(i.contacts,function(){delete this.__comp}),n.contacts.push(i);if(n.featureds)for(r=n.featureds,n.featureds=[],t=0;t<r.length;t++)i=jQuery.extend(!0,{},r[t]),delete i.__comp,n.featureds.push(i);if(n.youtubeLinks)for(r=n.youtubeLinks,n.youtubeLinks=[],t=0;t<r.length;t++)i=jQuery.extend(!0,{},r[t]),delete i.__comp,n.youtubeLinks.push(i);n.tripAdWidget&&(n.tripAdWidget=jQuery.extend(!0,{},n.tripAdWidget),delete n.tripAdWidget.__comp,delete n.tripAdWidget.trustLargeValue,delete n.tripAdWidget.trustSmallValue)}return n};o.goInEditMode=function(t){if(t)if(t.hasContent||t.id<=0)d(t);else{var i=function(n){n.data&&n.data.result&&(jQuery.extend(t,n.data.result),t.hasContent=!0,l(t),d(t))},r=function(n){n.data&&checkRedirectForSignIn(n.data)&&(o.errorstatus=n.status+" - "+n.statusText,o.errormsg=n.data.msg,o.errorid=n.data.id,o.showError=!0)},u=function(){t.gettingContent=!1};t.gettingContent=!0;n.post(f.urlGetAddressContent,{addrID:t.id}).then(i,r).finally(u)}};o.deleteModal=function(n){n&&(n.id>0?u.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"deleteAddressModal.html",controller:"deleteAddressInstanceCtrlr",controllerAs:"vm",size:"lg",appendTo:$("#addressesVw .modal-container"),resolve:{param:function(){return{address:n,save:o.save}}}}):o.addresses.remove(n))};c="";o.populateAddresses=function(t,r,u){var e=!1;s||(t=i.searchValue);e=t||c?t!==c||o.addressesCountMod!==0:o.addressesCountMod!==0;c=t;o.showError=!1;o.errorstatus="";o.errormsg="";o.errorid=0;r=r?r:f.resultItemsPerPg;u=u?u:0;t=t?t:o.searchValue;var h=function(n){var i,t,r;if(o.addresses.length=0,n.data&&((n.data.count>0||n.data.count===0&&n.data.result&&n.data.result.length===0)&&(o.addressesCountMod=0,o.addressesCount=n.data.count,i=parseInt(o.addressesCount/f.resultItemsPerPg),i+=o.addressesCount%f.resultItemsPerPg>0?1:0,o.totalPgs=i),it(),n.data.clients&&n.data.clients.length>0&&(o.clients.length=0,$.each(n.data.clients,function(n,t){t.name=t.legalName?t.legalName.encodeHtml():(t.civility?t.civility.toUpperCase()+" ":"")+(t.lName===null?"":t.lName.toUpperCase()+(t.fName?", ":""))+(t.fName?t.fName:"").encodeHtml();o.clients.push(t)})),n.data.categorys&&n.data.categorys.length>0&&(o.parentCategorys.length=0,o.categorys.length=0,$.each(n.data.categorys,function(n,t){t.name=t.name.encodeHtml();o.parentCategorys.push(t);t.children&&t.children.length>0&&$.each(t.children,function(n,i){i.parent=t;i.name=i.name.encodeHtml();o.categorys.push(i)})})),n.data.cityDetails&&n.data.cityDetails.length>0&&(o.cityDetails.length=0,$.each(n.data.cityDetails,function(n,t){t.name=t.name.encodeHtml();o.cityDetails.push(t)})),n.data.result))for(t=0;t<n.data.result.length;t++)r=n.data.result[t],k(r),o.addresses.push(r)},l=function(n){n.data&&checkRedirectForSignIn(n.data)&&(o.errorstatus=n.status+" - "+n.statusText,o.errormsg=n.data.msg,o.errorid=n.data.id,o.showError=!0)},a=function(){s||(s=!0,i.searchValue&&setSearchBarValue(i.searchValue),i.action==="edit"&&o.addresses.length>0&&o.goInEditMode(o.addresses[0]));toggleGlblWaitVisibility(!1)};toggleGlblWaitVisibility(!0);n.post(f.urlGetAddresses,{limit:r,offset:u,type:s||!i.searchType?null:i.searchType,getTotalAddresses:o.addressesCount<=0||e,name:t?t:null,getRefClients:o.clients.length===0,getRefCatgs:o.categorys.length===0,getRefCities:o.cityDetails.length===0}).then(h,l).finally(a)};g=function(n){if(n&&n.__comp)if(n.id>0){var t=n.__comp;n.name=t.name;n.slug=t.slug;n.client_Id=t.client_Id;n.client=t.client;n.cityDetail_Id=t.cityDetail_Id;n.cityDetail=t.cityDetail;n.category_Id=t.category_Id;n.parentCategory=t.parentCategory;n.category=t.category;n.latitude=t.latitude;n.longitude=t.longitude;n.desc_en=t.desc_en;n.desc_fr=t.desc_fr;n.flgRecByFbFans=t.flgRecByFbFans;n.rateOverride=t.rateOverride;n.rateOverrideCount=t.rateOverrideCount;n.status=t.status;n.active=t.active;n.inEditMode=!1}else o.addresses.remove(n)};nt=function(t,i){var r,u;if(t){Array.isArray(t)||(t=[t]);var s=!1,v=function(n){if(s=!0,n&&n.data&&n.data.result)for(r=0;r<n.data.result.length;r++){var t=n.data.result[r],i=$.grep(o.addresses,function(n){return n.uid===t.uid})[0];if(i){if(l(t),i.images&&t.images&&t.images.length>0)for(i.images.length=0,r=0;r<t.images.length;r++)i.images.push(t.images[r]);if(i.logos&&t.logos&&t.logos.length>0)for(i.logos.length=0,r=0;r<t.logos.length;r++)i.logos.push(t.logos[r]);if(i.documents&&t.documents&&t.documents.length>0)for(i.documents.length=0,r=0;r<t.documents.length;r++)i.documents.push(t.documents[r])}}},y=function(n){n.data&&checkRedirectForSignIn(n.data)&&(o.errorstatus=n.status+" - "+n.statusText,o.errormsg=n.data.msg,o.errorid=n.data.id,o.showError=!0)},c=function(){for(var n=0;n<t.length;n++)t[n].toBeUploadedFiles=[];toggleGlblWaitVisibility(!1);i&&i(s)},e=new FormData,a=!1;for(r=0;r<t.length;r++)u=t[r],u.toBeUploadedFiles&&(e.append("address",JSON.stringify({id:u.id,uid:u.uid,clientUID:u.clientUID})),$.each(u.toBeUploadedFiles,function(n,t){if(!t.recordState||t.recordState!==30){a=!0;var i=u.uid+"|"+t.value.type+"|"+n;e.append(i,t.file);h(t.value);e.append(i,JSON.stringify(t.value))}}));a?n.post(f.urlUploadAddressFiles,e,{transformRequest:angular.identity,headers:{"Content-Type":undefined}}).then(v,y).finally(c):(s=!0,c())}};o.save=function(t,i,r){var h,s,u;if(t){Array.isArray(t)||(t=[t]);r&&!Array.isArray(r)&&(r=[r]);var e=[],c=[],v=r&&r.length===t.length;for(h=0;h<t.length;h++)s=t[h],s&&s.__comp&&(u=ut(jQuery.extend(!1,{},s)),delete u.__comp,u.status=u.active?1:0,u.client_Id=u.client?u.client.id:0,delete u.client,u.category_Id=u.category?u.category.id:u.parentCategory?u.parentCategory.id:0,delete u.parentCategory,delete u.category,u.cityDetail_Id=u.cityDetail?u.cityDetail.id:0,delete u.cityDetail,b(u,s.__comp,v?r[h]:!1),u.status=u.active?1:0,u.ratingOverrides&&$.each(u.ratingOverrides,function(n,t){t.fromUtc=f.swIsoFormat(t.fromDate,!0);t.toUtc=f.swIsoFormat(t.toDate,!0);delete t.fromDate;delete t.toDate}),u.featureds&&$.each(u.featureds,function(n,t){t.fromUtc=f.swIsoFormat(t.fromDate,!0);t.toUtc=f.swIsoFormat(t.toDate,!0);t.type=t.typeObj?t.typeObj.value:0;delete t.fromDate;delete t.toDate}),u.youtubeLinks&&$.each(u.youtubeLinks,function(n,t){t.fromUtc=f.swIsoFormat(t.fromDate,!0);t.toUtc=f.swIsoFormat(t.toDate,!0);delete t.fromDate;delete t.toDate}),c.push(u),e.push(s));if(e.length>0){var a=!1,y=function(n){n.data&&n.data.result&&n.data.result.length>0&&(e.length===n.data.result.length&&$.each(n.data.result,function(n,t){var i=e[n],r;if(t&&t.address){if(i.id=t.address.id,i.name=t.address.name,i.slug=t.address.slug,i.client_Id=t.address.client_Id,i.cityDetail_Id=t.address.cityDetail_Id,i.category_Id=t.address.category_Id,i.latitude=t.address.latitude,i.longitude=t.address.longitude,i.flgRecByFbFans=t.address.flgRecByFbFans,i.rateOverride=t.address.rateOverride,i.rateOverrideCount=t.address.rateOverrideCount,i.rate=t.address.rate,i.rateCount=t.address.rateCount,i.status=t.address.status,i.active=i.status===1,k(i),l(t),i.desc_en=t.desc_en,i.desc_fr=t.desc_fr,t.ratingOverrides&&i.ratingOverrides)for(i.ratingOverrides.length=0,r=0;r<t.ratingOverrides.length;r++)i.ratingOverrides.push(t.ratingOverrides[r]);if(t.tags&&i.tags)for(i.tags.length=0,r=0;r<t.tags.length;r++)i.tags.push(t.tags[r]);if(t.images&&i.images)for(i.images.length=0,r=0;r<t.images.length;r++)i.images.push(t.images[r]);if(t.logos&&i.logos)for(i.logos.length=0,r=0;r<t.logos.length;r++)i.logos.push(t.logos[r]);if(t.documents&&i.documents)for(i.documents.length=0,r=0;r<t.documents.length;r++)i.documents.push(t.documents[r]);if(t.openHours&&i.openHours)for(i.openHours.length=0,r=0;r<t.openHours.length;r++)i.openHours.push(t.openHours[r]);if(t.contacts&&i.contacts)for(i.contacts.length=0,r=0;r<t.contacts.length;r++)i.contacts.push(t.contacts[r]);if(t.featureds&&i.featureds)for(i.featureds.length=0,r=0;r<t.featureds.length;r++)i.featureds.push(t.featureds[r]);if(t.youtubeLinks&&i.youtubeLinks)for(i.youtubeLinks.length=0,r=0;r<t.youtubeLinks.length;r++)i.youtubeLinks.push(t.youtubeLinks[r]);i.tripAdWidget&&(t.tripAdWidget?(i.tripAdWidget.status=t.tripAdWidget.status,i.tripAdWidget.uid=t.tripAdWidget.uid,i.tripAdWidget.id=t.tripAdWidget.id,i.tripAdWidget.largeValue=t.tripAdWidget.largeValue,i.tripAdWidget.smallValue=t.tripAdWidget.smallValue):(i.tripAdWidget.status=1,i.tripAdWidget.uid=null,i.tripAdWidget.id=0,i.tripAdWidget.largeValue=null,i.tripAdWidget.smallValue=null),i.tripAdWidget.recordState=0);c[n].recordState===10&&(o.addressesCountMod+=1,(!o.totalPgs||o.totalPgs<=0)&&(o.totalPgs=1));delete i.status;delete i.recordState;i.__comp=t}else o.addresses.remove(i),o.addressesCountMod-=1,o.addressesCount+o.addressesCountMod<=0&&(o.totalPgs=0)}),a=!0)},p=function(n){n.data&&checkRedirectForSignIn(n.data)&&(o.errorstatus=n.status+" - "+n.statusText,o.errormsg=n.data.msg,o.errorid=n.data.id,o.showError=!0)},w=function(){a&&e.length>0?nt(e,i):(toggleGlblWaitVisibility(!1),i&&i(a))};o.showError=!1;o.errorstatus="";o.errormsg="";o.errorid=0;toggleGlblWaitVisibility(!0);n.post(f.urlSaveAddresses,{addresses:c}).then(y,p).finally(w)}}};tt=function(){var i=$(this),n,r;i.hasClass("refresh")?(n=$.grep(o.pgsCollection,function(n){return n.isActive}),n&&Array.isArray(n)&&(n=n.length>0?n[0]:null),n&&(r=f.resultItemsPerPg*n.index-1,t.$apply(function(){o.populateAddresses(null,f.resultItemsPerPg,r)}))):i.hasClass("add")&&t.$apply(function(){var n={id:0,name:"",slug:"",client_Id:0,client:null,cityDetail_Id:0,cityDetail:null,category_Id:0,parentCategory:null,category:null,latitude:0,longitude:0,flgRecByFbFans:!1,rateOverride:0,rateOverrideCount:0,rate:0,rateCount:0,status:1,active:!0,recordState:10};n.__comp=jQuery.extend(!0,{},n);n.inEditMode=!0;n.saving=!1;o.addresses.insert(0,n);o.goInEditMode(n)})};$("#searchBar .btn.btn-tb").on("click",tt);$("#searchBar").on("searchGo",function(n,i){i&&i.searchValue&&t.$apply(function(){o.searchValue=i.searchValue;o.populateAddresses(i.searchValue,f.resultItemsPerPg,0)})});$("#searchBar").on("searchClear",function(){t.$apply(function(){o.searchValue="";o.populateAddresses(null,f.resultItemsPerPg,0)})})}function t(n,t,r,u,f,e,o){var s=this,h;s.appProps=f;s.vmRoot=o.vmRoot;s.address=o.address;s.clients=o.clients;s.parentCategorys=o.parentCategorys;s.categorys=o.categorys;s.cityDetails=o.cityDetails;s.tags=o.tags;s.featuredTypes=o.featuredTypes;s.checkFilesRecordState=o.checkFilesRecordState;s.checkOpenHoursRecordState=o.checkOpenHoursRecordState;s.checkContactsRecordState=o.checkContactsRecordState;s.checkTripAdWidget=function(n){n&&(n.largeValue&&(n.largeValue=n.largeValue.replaceAll('"',"'")),n.smallValue&&(n.smallValue=n.smallValue.replaceAll('"',"'")),o.checkTripAdWidgetRecordState(n))};s.tagFilter="";s.slugify=function(){s.address&&(s.address.slug||(s.address.slug=e.slugify(s.address.name)))};t.$watch("vm.tagFilter",function(n){var i,t,r;if(s.tags&&s.tags.length>0)if(n&&n.length>0)for(r=String(accentFold(n)).toLowerCase(),t=0;t<s.tags.length;t++)i=s.tags[t],i.isFilteredOut=String(accentFold(i.name)).toLowerCase().indexOf(r)<0;else for(t=0;t<s.tags.length;t++)i=s.tags[t],i.isFilteredOut=!1});s.selectedTagCount=0;s.tripadCode=!0;s.tripadPreview=!1;s.selectTag=function(n){n&&(n.isSelected?(n.isSelected=!1,s.selectedTagCount>0&&s.selectedTagCount--):(n.isSelected=!0,s.selectedTagCount++))};s.showAddTags=!1;s.gettingAddTags=!1;s.applyTags=function(){var n,t;if(s.tags&&s.tags.length>0)for(n=0;n<s.tags.length;n++)t=s.tags[n],t.isSelected&&s.address.tags.insert(0,{recordState:10,id:t.id,address_Id:s.address.id,name:t.name,active:!0,status:1});s.showAddTags=!1};s.addressTagClick=function(n){if(n)switch(n.recordState){case 30:n.recordState=0;break;case 10:n.recordState=0;s.address.tags.remove(n);break;default:n.recordState=30}};s.openAddTags=function(){var i,t;if(s.selectedTagCount=0,s.showAddTags=!0,s.tags&&s.tags.length>0)for(i=0;i<s.tags.length;i++)t=s.tags[i],t.isSelected=!1,t.isFilteredOut=!1,t.isVisible=!0,$.grep(s.address.tags,function(n){return n.id===t.id}).length>0&&(t.isVisible=!1);else{s.gettingAddTags=!0;var r=function(n){var i,t;if(s.tags.length=0,n.data&&n.data.result)for(i=0;i<n.data.result.length;i++)t=n.data.result[i],t.name=f.currentLang.startsWith("en")?t.name_en:t.name_fr,t.isSelected=!1,t.isFilteredOut=!1,t.isVisible=!0,$.grep(s.address.tags,function(n){return n.id===t.id}).length>0&&(t.isVisible=!1),s.tags.push(t)},u=function(n){n.data&&checkRedirectForSignIn(n.data)&&(s.errorstatus=n.status+" - "+n.statusText,s.errormsg=n.data.msg,s.errorid=n.data.id,s.showError=!0)},e=function(){s.gettingAddTags=!1};n.post(f.urlGetTags,{}).then(r,u).finally(e)}$("#addressesVw .modal-editor .modal-dialog .modal-content .add-tags-bg .add-tags-container .form-group .form-control input").on("focusin focusout",function(){var n=$($(this).parent());n&&n.length>0&&n.toggleClass("has-focus")})};h=function(n){n&&s.address&&s.address.toBeUploadedFiles&&s.address.toBeUploadedFiles.length>0&&$.each($.grep(s.address.toBeUploadedFiles,function(t){return t.value===n}),function(n,t){s.address.toBeUploadedFiles.remove(t)})};s.revertFile=function(n,t){if(n&&n.__comp){if(n.name=n.__comp.name,n.format=n.__comp.format,n.alt=n.__comp.alt,n.desc=n.__comp.desc,n.active=n.__comp.active,n.isDefault!==n.__comp.isDefault&&(n.isDefault=n.__comp.isDefault,t&&t.length>0))if(n.isDefault)$.each($.grep(t,function(t){return t!==n&&t.isDefault===!0}),function(){this.isDefault=!1;s.checkFilesRecordState(this)});else{var i=t.indexOf(n);i>=0&&(i+=1,i=i>=t.length?0:i,t[i].isDefault=!0,s.checkFilesRecordState(t[i]))}n.recordState=0;n.waitingUpload=!1;h(n)}};s.uploadImgClick=function(n,i){var u,r;if(i)if(i.waitingUpload)i.__comp?(i.name=i.__comp.name,i.format=i.__comp.format):(i.name="",i.format="",u=$(n.currentTarget).parents("tr").find("img.local").first(),u&&u.length>0&&u.attr("src","")),i.waitingUpload=!1,i.recordState=i.recordStateBeforeUpload?i.recordStateBeforeUpload:0,h(i);else if(n&&n.currentTarget&&(r=$(n.currentTarget).siblings('input[type="file"]'),r&&r.length>0)){r.off("change");r.on("change",function(){t.$apply(function(){var n,t,u;s.address&&(s.address.toBeUploadedFiles||(s.address.toBeUploadedFiles=[]),n=r.get(0).files,n&&n.length>0&&($.each(n,function(n,t){var u=null,r=null;t.name&&(r=t.name.split("."),r&&r.length>0?(u=String(r[0]).toLowerCase(),r=String(r[r.length-1]).toLowerCase()):(u=null,r=null));i.name=u;i.format=r;s.address.toBeUploadedFiles.push({file:t,key:t.name+"_"+n+"_KEY",value:i})}),t=r.parents("tr").first().find("td img.local"),t&&t.length>0&&(u=new FileReader,u.onload=function(n){t.attr("src",n.target.result)},u.readAsDataURL(n[0]))),i.waitingUpload=!0,i.recordStateBeforeUpload=i.recordState,s.checkFilesRecordState(i))})});r.first().click()}};s.fileSetToDefault=function(n,t){n&&t&&t.length>0&&(n.active?($.each($.grep(t,function(n){return n.isDefault===!0}),function(){this.isDefault=!1;s.checkFilesRecordState(this)}),n.isDefault=!0):n.isDefault=!1);s.checkFilesRecordState(n)};s.fileSetActive=function(n,t){var u,r,i;n&&t&&t.length>0&&(n.active?(u=$.grep(t,function(n){return n.isDefault===!0}).length,u===0&&(n.isDefault=!0)):n.isDefault&&(n.isDefault=!1,r=$.grep(t,function(t){return t===n||t.active===!0}),r.length>1&&(i=r.indexOf(n),i>=0&&(i+=1,i=i>=r.length?0:i,r[i].isDefault=!0,s.checkFilesRecordState(r[i])))));n.status=n.active?1:0;s.checkFilesRecordState(n)};s.revertContact=function(n){n&&n.__comp&&(n.text=n.__comp.text,n.link=n.__comp.link,n.status=n.__comp.status,n.active=n.__comp.active,n.recordState=0);s.checkContactsRecordState(n)};s.contactValueChanged=function(n){s.checkContactsRecordState(n)};s.revertDayRow=function(n){n&&n.__comp&&(n.timeFrom=n.__comp.timeFrom,n.timeTo=n.__comp.timeTo,n.hrFrom=n.__comp.hrFrom,n.hrTo=n.__comp.hrTo,n.minFrom=n.__comp.minFrom,n.minTo=n.__comp.minTo,n.active=n.__comp.active,n.recordState=0,n.waitingUpload=!1);s.checkOpenHoursRecordState(n)};s.timeFromChanged=function(n){n&&(n.timeFrom?(n.hrFrom=n.timeFrom.getHours(),n.minFrom=n.timeFrom.getMinutes()):(n.hrFrom=0,n.minFrom=0));s.checkOpenHoursRecordState(n)};s.timeToChanged=function(n){n&&(n.timeTo?(n.hrTo=n.timeTo.getHours(),n.minTo=n.timeTo.getMinutes()):(n.hrTo=0,n.minTo=0))};s.revertTripAd=function(){s.address&&s.address.tripAdWidget&&s.address.tripAdWidget.__comp&&(s.address.tripAdWidget.smallValue=s.address.tripAdWidget.__comp.smallValue,s.address.tripAdWidget.largeValue=s.address.tripAdWidget.__comp.largeValue,s.address.tripAdWidget.recordState=0)};s.deleteTripAd=function(){s.address&&s.address.tripAdWidget&&(s.address.tripAdWidget.smallValue=null,s.address.tripAdWidget.largeValue=null,s.address.tripAdWidget.recordState=s.address.tripAdWidget.recordState&&s.address.tripAdWidget.recordState===10?0:30)};s.save=function(){o.save(s.address)};s.close=function(){s.address&&(s.address.id>0?o.revertAddress(s.address):o.deleteModal(s.address));u.close()};s.addRatingOverride=function(){var n={id:0,fromUtc:null,fromDate:new Date,toUtc:null,toDate:null,value:0,clickCount:0,status:1,recordState:10,active:!0};s.address.ratingOverrides.insert(0,n)};s.addFeatured=function(){var n={id:0,fromUtc:null,fromDate:new Date,toUtc:null,toDate:null,status:1,recordState:10,active:!0};s.address.featureds.insert(0,n)};s.addYoutubeLink=function(){var n={id:0,fromUtc:null,fromDate:new Date,name:"",url:"",type:10,toUtc:null,toDate:null,status:1,recordState:10,active:!0};s.address.youtubeLinks.insert(0,n)};s.addLogo=function(){var n={recordState:10,id:0,type:50,isDefault:$.grep(s.address.logos,function(n){return n.isDefault===!0}).length<=0,uid:null,alt:null,desc:null,status:1,active:!0};s.address.logos.insert(0,n)};s.addImage=function(){var n={recordState:10,id:0,type:10,isDefault:$.grep(s.address.images,function(n){return n.isDefault===!0}).length<=0,uid:null,alt:null,desc:null,status:1,active:!0};s.address.images.insert(0,n)};s.addDoc=function(){var n={recordState:10,id:0,type:0,isDefault:$.grep(s.address.documents,function(n){return n.isDefault===!0}).length<=0,uid:null,alt:null,desc:null,status:1,active:!0};s.address.documents.insert(0,n)};s.addOpenHours=function(n){if(n&&n.openHours)n.openHours.insert(0,{recordState:10,id:0,hrFrom:null,hrTo:null,minFrom:null,minTo:null,status:1,active:!0})};s.addContact=function(n){if(n&&n.contacts){var t={recordState:10,id:0,name:n.name,link:null,text:null,status:1,active:!0};n.contacts.insert(0,t)}};s.markRowForDeletion=function(n,t){n&&t&&(n.recordState===10?t.remove(n):n.recordState===30?n.recordState=n.recordStateBeforeDelete:(n.recordStateBeforeDelete=n.recordState,n.recordState=30))};s.setRatingToDelete=function(n){n&&(n.recordState===10?s.address.ratingOverrides.remove(n):(n.prevRecordState=n.recordState,n.recordState=30))};s.setFeaturedToDelete=function(n){n&&(n.recordState===10?s.address.featureds.remove(n):(n.prevRecordState=n.recordState,n.recordState=30))};s.setYoutubeLinkToDelete=function(n){n&&(n.recordState===10?s.address.youtubeLinks.remove(n):(n.prevRecordState=n.recordState,n.recordState=30))};s.revertFeatured=function(n){n&&n.__comp&&(n.fromDate=n.__comp.fromDate,n.toDate=n.__comp.toDate,n.type=n.__comp.type,n.fromUtc=n.__comp.fromUtc,n.toUtc=n.__comp.toUtc,n.status=n.__comp.status,n.active=n.__comp.active,n.recordState=0);o.checkFeaturedsRecordState(n)};s.revertYoutubeLink=function(n){n&&n.__comp&&(n.fromDate=n.__comp.fromDate,n.toDate=n.__comp.toDate,n.fromUtc=n.__comp.fromUtc,n.toUtc=n.__comp.toUtc,n.name=n.__comp.name,n.webUrl=n.__comp.webUrl,n.url=n.__comp.url,n.status=n.__comp.status,n.active=n.__comp.active,n.recordState=0);o.checkYoutubeLinksRecordState(n)};s.featuredChanged=function(n){o.checkFeaturedsRecordState(n)};s.youtubeLinkChanged=function(n){o.checkYoutubeLinksRecordState(n)};u.closed.then(function(){$("body").attr("style","")});i(s)}function i(n){n&&(n.initFrmDetails=function(){n.address&&listItemService.setItemFormValidation(n.address,[{name:"name",isReq:!0},{name:"slug",isReq:!0},{name:"client",isReq:!0},{name:"cityDetail",isReq:!0},{name:"category",isReq:!0},{name:"latitude",isReq:!0},{name:"longitude",isReq:!0}])})}function r(n,t,i){var r=this;r.appProps=t;r.address=i.address;r.yes=function(){n.close(r.address);toggleGlblWaitVisibility(!0);i.save(i.address,function(){toggleGlblWaitVisibility(!1)},!0)};r.no=function(){n.close()}}angular.module("app-mainmenu").controller("addressesCtrlr",["$http","$scope","$routeParams","$sce","$uibModal","appProps","headerConfigService",n]);angular.module("app-mainmenu").controller("addressEditorInstanceCtrlr",["$http","$scope","$sce","$uibModalInstance","appProps","miscToolsService","param",t]);angular.module("app-mainmenu").controller("deleteAddressInstanceCtrlr",["$uibModalInstance","appProps","param",r])})();