(function(){"use strict";function n(n,t,i,r,u){var f,c,e,h,o,s;$("[data-toggle=tooltip]").tooltip({trigger:"hover"});u.reset();u.title=r.lbl_Import;u.showToolBar=!1;u.showSearchCtrl=!1;u.showSaveBtn=!1;u.addBtnTltp=r.msg_AddClnts;u.refreshBtnTltp=r.msg_RfrshClnts;u.saveBtnTltp=r.msg_SaveClnts;f=this;f.appProps=r;f.showUpload=!0;f.showClear=!1;f.showTable=!1;f.showError=!1;f.hasFile=!1;f.hasSuccess=!1;f.csvItems=[];f.tableHeaders=[];f.categories=[];f.categoryErrorsCount=0;f.errorCount=0;f.errorstatus="";f.errormsg="";f.errorid=0;f.addrFilename="";f.timeFilename="";c=$("#csv");e=document.getElementById("csv-table").getElementsByTagName("tbody")[0].getElementsByTagName("tr");f.browseGo=function(n){n&&$("#"+n).click()};h=function(n){n&&(n.addressName=n.addressName?n.addressName.encodeHtml():n.addressName)};f.uploadCSvForm=function(){var t,i;if(f.categoryErrorsCount=0,t=$("#addrCSV").get(0),t&&t.files.length===1){i=new FormData;i.append("ADDR_CSV",t.files[0]);t=$("#timeCSV").get(0);t&&t.files.length===1&&i.append("TIME_CSV",t.files[0]);var r=function(n){var i,u,s,t,r,e,o;if(n&&n.data)if(n.data.error)f.showUpload=!1,f.showClear=!0,f.showTable=!0,f.errormsg=n.data.error;else if(n.data.addresses){for(t=0;t<n.data.processedCsvCatgs.length;t++)if(i=n.data.processedCsvCatgs[t],i&&(f.categories.push(i),f.categoryErrorsCount+=i.foundInDb?0:1,i.showSubCatgs=!0,i.subCategories))for(u=0;u<i.subCategories.length;u++)s=i.subCategories[t],f.categoryErrorsCount+=s.foundInDb?0:1;for(t=0;t<n.data.addresses.length;t++){if(r=n.data.addresses[t],t===0)for(e in r)e.startsWith("_")||f.tableHeaders.push(e);h(r);f.csvItems.push(r)}for(o=f.csvItems.map(function(n){return n.errorMessage}),t=0;t<o.length;t++)o[t]===null?f.hasSuccess=!0:f.errorCount++;f.showUpload=!1;f.showClear=!0;f.showTable=!0}},u=function(n){n.data&&(f.errorstatus=n.status+" - "+n.statusText,f.errormsg=n.data.msg,f.errorid=n.data.id,f.showError=!0)},e=function(){toggleGlblWaitVisibility(!1)};f.errormsg="";f.csvItems.length=0;f.tableHeaders.length=0;f.errorCount=0;toggleGlblWaitVisibility(!0);n({url:"/ApiBulkImport/UploadCSV",method:"POST",data:i,headers:{"Content-Type":undefined},transformRequest:angular.identity}).then(r,u).finally(e)}};o=document.getElementById("addrCSV");o.onchange=function(){t.$apply(function(){f.addrFilename=o.files[0].name})};s=document.getElementById("timeCSV");s.onchange=function(){t.$apply(function(){f.timeFilename=s.files[0].name})};f.clearForm=function(){f.hasSuccess=!1;f.showTable=!1;f.showClear=!1;f.showUpload=!0;f.addrFilename="";f.timeFilename="";o.value="";s.value="";f.csvItems.length=0;f.tableHeaders.length=0;f.categories.length=0;f.categoryErrorsCount=0};f.showAll=function(){for(var n,r,i=f.csvItems.map(function(n){return n.errorMessage}),t=0;t<i.length;t++)for(n=0;n<e.length;n++)r=e[n],r.hidden=i[t]===null?!1:!1};f.showAllSuccess=function(){for(var n,r,i=f.csvItems.map(function(n){return n.errorMessage}),t=0;t<i.length;t++)for(n=0;n<e.length;n++)r=e[n],r.hidden=i[t]===null?!1:!0};f.showAllErrors=function(){for(var n,r,i=f.csvItems.map(function(n){return n.errorMessage}),t=0;t<i.length;t++)for(n=0;n<e.length;n++)r=e[n],r.hidden=i[t]===null?!0:!1}}function t(n,t,i){var r=this;r.appProps=t;r.client=i.client;r.yes=function(){n.close(r.client);toggleGlblWaitVisibility(!0);i.save(i.client,function(){toggleGlblWaitVisibility(!1)},!0)};r.no=function(){n.close()}}angular.module("app-mainmenu").controller("bulkImportCtrlr",["$http","$scope","$uibModal","appProps","headerConfigService",n]);angular.module("app-mainmenu").controller("deleteClientInstanceCtrlr",["$uibModalInstance","appProps","param",t])})();