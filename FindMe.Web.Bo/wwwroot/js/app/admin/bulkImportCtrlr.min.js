(function(){"use strict";function n(n,t,i,r,u,f,e){var o,a,s,l,h,c;$("[data-toggle=tooltip]").tooltip({trigger:"hover"});u.reset();u.title=r.lbl_Import;u.showToolBar=!1;u.showSearchCtrl=!1;u.showSaveBtn=!1;u.addBtnTltp=r.msg_AddClnts;u.refreshBtnTltp=r.msg_RfrshClnts;u.saveBtnTltp=r.msg_SaveClnts;o=this;o.appProps=r;o.showUpload=!0;o.showClear=!1;o.showTable=!1;o.showError=!1;o.hasFile=!1;o.catExist=!0;o.subCatExist=!0;o.hasSuccess=!1;o.csvItems=[];o.tableHeaders=[];o.categories=[];o.subCategories=[];o.categoryCount=0;o.subCategoryCount=0;o.errorCount=0;o.errorstatus="";o.errormsg="";o.errorid=0;o.addrFilename="";o.timeFilename="";o.log={text:""};a=$("#csv");s=document.getElementById("csv-table").getElementsByTagName("tbody")[0].getElementsByTagName("tr");o.browseGo=function(n){n&&$("#"+n).click()};l=function(n){n&&(n.addressName=n.addressName?n.addressName.encodeHtml():n.addressName)};o.uploadCSvForm=function(){var t=$("#addrCSV").get(0),i;if(t&&t.files.length===1){i=new FormData;i.append("ADDR_CSV",t.files[0]);t=$("#timeCSV").get(0);t&&t.files.length===1&&i.append("TIME_CSV",t.files[0]);var r=function(n){var t,i,u,r;if(n&&n.data)if(n.data.error)o.showUpload=!1,o.showClear=!0,o.showTable=!0,o.errormsg=n.data.error;else if(n.data.addresses){for(t=0;t<n.data.processedCsvCatgs.length;t++){var f=n.data.processedCsvCatgs,e=n.data.processedCsvCatgs[t].subCategories,s=n.data.processedCsvCatgs[t].foundInDb,h=n.data.processedCsvCatgs[t].subCategories[t].foundInDb;s==!1?(o.categoryCount++,o.catExist=!1):h==!1&&(o.subCategoryCount++,o.subCatExist=!1);o.categories.push(f[t]);o.subCategories.push(e[t])}for(t=0;t<n.data.addresses.length;t++){if(i=n.data.addresses[t],t===0)for(u in i)u.startsWith("_")||o.tableHeaders.push(u);l(i);o.csvItems.push(i)}for(r=o.csvItems.map(function(n){return n.errorMessage}),t=0;t<r.length;t++)r[t]===null?o.hasSuccess=!0:(o.errorCount++,o.log.text=r[t]);o.showUpload=!1;o.showClear=!0;o.showTable=!0;o.catExist=!1;o.subCatExist=!1}},u=function(n){n.data&&(o.errorstatus=n.status+" - "+n.statusText,o.errormsg=n.data.msg,o.errorid=n.data.id,o.showError=!0)},f=function(){toggleGlblWaitVisibility(!1)};o.errormsg="";o.csvItems.length=0;o.tableHeaders.length=0;o.errorCount=0;o.categoryCount=0;o.subCategoryCount=0;toggleGlblWaitVisibility(!0);n({url:"/ApiBulkImport/UploadCSV",method:"POST",data:i,headers:{"Content-Type":undefined},transformRequest:angular.identity}).then(r,u).finally(f)}};h=document.getElementById("addrCSV");h.onchange=function(){t.$apply(function(){o.addrFilename=h.files[0].name})};c=document.getElementById("timeCSV");c.onchange=function(){t.$apply(function(){o.timeFilename=c.files[0].name})};o.clearForm=function(){o.hasSuccess=!1;o.showTable=!1;o.showClear=!1;o.showUpload=!0;o.catExist=!0;o.subCatExist=!0;o.addrFilename="";o.timeFilename="";h.value="";c.value="";o.csvItems.length=0;o.tableHeaders.length=0;o.categories.length=0};o.showAll=function(){for(var n,r,i=o.csvItems.map(function(n){return n.errorMessage}),t=0;t<i.length;t++)for(n=0;n<s.length;n++)r=s[n],r.hidden=i[t]===null?!1:!1};o.showAllSuccess=function(){for(var n,r,i=o.csvItems.map(function(n){return n.errorMessage}),t=0;t<i.length;t++)for(n=0;n<s.length;n++)r=s[n],r.hidden=i[t]===null?!1:!0};o.showAllErrors=function(){for(var n,r,i=o.csvItems.map(function(n){return n.errorMessage}),t=0;t<i.length;t++)for(n=0;n<s.length;n++)r=s[n],r.hidden=i[t]===null?!0:!1};o.download=function(n){var t=new e([n],{type:"text/plain;charset=utf-8"});f.saveAs(t,"log.txt")}}function t(n,t,i){var r=this;r.appProps=t;r.client=i.client;r.yes=function(){n.close(r.client);toggleGlblWaitVisibility(!0);i.save(i.client,function(){toggleGlblWaitVisibility(!1)},!0)};r.no=function(){n.close()}}angular.module("app-mainmenu").controller("bulkImportCtrlr",["$http","$scope","$uibModal","appProps","headerConfigService","FileSaver","Blob",n]);angular.module("app-mainmenu").controller("deleteClientInstanceCtrlr",["$uibModalInstance","appProps","param",t])})();