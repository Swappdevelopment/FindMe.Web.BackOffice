(function(){"use strict";function n(n,f,e,o,s){var h,l,v,a,c;$("[data-toggle=tooltip]").tooltip({trigger:"hover"});s.reset();s.title=$("<textarea>"+o.lbl_CtsRgnsDstrctsGrps+"<\/textarea>").text();s.showToolBar=!0;s.showSearchCtrl=!0;s.showSaveBtn=!1;s.addBtnTltp=o.msg_AddCty;s.refreshBtnTltp=o.msg_RfrshCtys;s.saveBtnTltp=o.msg_SaveCtys;h=this;h.appProps=o;h.tabIndex=0;h.clearParentFilter=function(){h.cVm&&h.cVm.parentFilter&&(h.cVm.parentFilter.id=0,h.cVm.parentFilter.text=null,h.cVm.parentFilter.type=null,h.cVm.populateCityDetails())};l=function(n,t){if(n!==t)switch(n){case 0:s.addBtnTltp=o.msg_AddCty;s.refreshBtnTltp=o.msg_RfrshCtys;s.saveBtnTltp=o.msg_SaveCtys;h.cVm&&(setSearchBarValue(h.cVm.searchValue),h.cVm.cityDetails&&h.cVm.cityDetails.length!==0||h.cVm.populateCityDetails&&h.cVm.populateCityDetails());break;case 1:s.addBtnTltp=o.msg_AddRgn;s.refreshBtnTltp=o.msg_RfrshRgns;s.saveBtnTltp=o.msg_SaveRgns;h.rVm&&(setSearchBarValue(h.rVm.searchValue),h.rVm.regions&&h.rVm.regions.length!==0||h.rVm.populateRegions&&h.rVm.populateRegions());break;case 2:s.addBtnTltp=o.msg_AddDstrct;s.refreshBtnTltp=o.msg_RfrshDstrcts;s.saveBtnTltp=o.msg_SaveDstrcts;h.dVm&&(setSearchBarValue(h.dVm.searchValue),h.dVm.districts&&h.dVm.districts.length!==0||h.dVm.populateDistricts&&h.dVm.populateDistricts());break;case 3:s.addBtnTltp=o.msg_AddCtyGrp;s.refreshBtnTltp=o.msg_RfrshCtyGrps;s.saveBtnTltp=o.msg_SaveCtyGrps;h.gVm&&(setSearchBarValue(h.gVm.searchValue),h.gVm.cityGroups&&h.gVm.cityGroups.length!==0||h.gVm.populateCityGroups&&h.gVm.populateCityGroups())}};f.$watch("vm.tabIndex",l);t(n,f,e,o,s,h);i(n,f,e,o,s,h);r(n,f,e,o,s,h);u(n,f,e,o,s,h);v=function(){h.showError=!1;h.errorstatus="";h.errormsg="";h.errorid=0;var t=function(n){n&&n.data&&(h.rVm.populateSuccessFunc({data:n.data.regionsData}),h.dVm.populateSuccessFunc({data:n.data.districtsData}),h.gVm.populateSuccessFunc({data:n.data.cityGroupsData}),h.cVm.populateSuccessFunc({data:n.data.cityDetailsData}))},i=function(n){n.data&&checkRedirectForSignIn(n.data)&&(h.errorstatus=n.status+" - "+n.statusText,h.errormsg=n.data.msg,h.errorid=n.data.id,h.showError=!0)},r=function(){toggleGlblWaitVisibility(!1)};toggleGlblWaitVisibility(!0);n.post(o.urlGetAllCityStuff).then(t,i).finally(r)};a=function(){var n=$(this);n.hasClass("refresh")?f.$apply(function(){var n,t;switch(h.tabIndex){case 0:h.cVm&&h.cVm.populateCityDetails&&(n=$.grep(h.cVm.pgsCollection,function(n){return n.isActive}),n&&Array.isArray(n)&&(n=n.length>0?n[0]:null),n&&(t=o.resultItemsPerPg*n.index-1,h.cVm.populateCityDetails(o.resultItemsPerPg,t)));break;case 1:h.rVm&&h.rVm.populateRegions&&(n=$.grep(h.rVm.pgsCollection,function(n){return n.isActive}),n&&Array.isArray(n)&&(n=n.length>0?n[0]:null),n&&(t=o.resultItemsPerPg*n.index-1,h.rVm.populateRegions(o.resultItemsPerPg,t)));break;case 2:h.dVm&&h.dVm.populateDistricts&&(n=$.grep(h.dVm.pgsCollection,function(n){return n.isActive}),n&&Array.isArray(n)&&(n=n.length>0?n[0]:null),n&&(t=o.resultItemsPerPg*n.index-1,h.dVm.populateDistricts(o.resultItemsPerPg,t)));break;case 3:h.gVm&&h.gVm.populateCityGroups&&(n=$.grep(h.gVm.pgsCollection,function(n){return n.isActive}),n&&Array.isArray(n)&&(n=n.length>0?n[0]:null),n&&(t=o.resultItemsPerPg*n.index-1,h.gVm.populateCityGroups(o.resultItemsPerPg,t)))}}):n.hasClass("add")&&f.$apply(function(){switch(h.tabIndex){case 0:h.cVm&&h.cVm.addCityDetail&&h.cVm.addCityDetail();break;case 1:h.rVm&&h.rVm.addRegion&&h.rVm.addRegion();break;case 2:h.dVm&&h.dVm.addDistrict&&h.dVm.addDistrict();break;case 3:h.gVm&&h.gVm.addCityGroup&&h.gVm.addCityGroup()}})};$("#searchBar .btn.btn-tb").on("click",a);c=function(n,t){if(t){t.searchValue=t.searchValue?t.searchValue:null;switch(h.tabIndex){case 0:h.cVm&&h.cVm.populateCityDetails&&(h.cVm.searchValue||t.searchValue)&&h.cVm.searchValue!=t.searchValue&&(h.cVm.searchValue=t.searchValue,h.cVm.populateCityDetails(o.resultItemsPerPg,0,t.searchValue));break;case 1:h.rVm&&h.rVm.populateRegions&&(h.rVm.searchValue||t.searchValue)&&h.rVm.searchValue!=t.searchValue&&(h.rVm.searchValue=t.searchValue,h.rVm.populateRegions(o.resultItemsPerPg,0,t.searchValue));break;case 2:h.dVm&&h.dVm.populateDistricts&&(h.dVm.searchValue||t.searchValue)&&h.dVm.searchValue!=t.searchValue&&(h.dVm.searchValue=t.searchValue,h.dVm.populateDistricts(o.resultItemsPerPg,0,t.searchValue));break;case 3:h.gVm&&h.gVm.populateCityGroups&&(h.gVm.searchValue||t.searchValue)&&h.gVm.searchValue!=t.searchValue&&(h.gVm.searchValue=t.searchValue,h.gVm.populateCityGroups(o.resultItemsPerPg,0,t.searchValue))}}};$("#searchBar").on("searchGo",c);$("#searchBar").on("searchClear",function(n){c(n,{})});h.cVm.populateCityDetails()}function t(n,t,i,r,u,f){var e,h,c,o,s;f.cVm={};e=f.cVm;e.parentFilter={id:0,text:null,type:null};e.pgsCollection=[];e.currentPgNmbr=0;e.totalPgs=0;e.cityDetailsCount=0;e.cityDetailsCountMod=0;e.cityDetails=[];e.refRegions=[];e.refDistricts=[];e.refCityGroups=[];e.defCountry=null;e.gotoPage=function(n,t){if(n&&!n.isActive&&!n.disabled){t;var i=r.resultItemsPerPg*n.index-1;i=i<0?0:i;e.currentPgNmbr=n.index;e.populateCityDetails(r.resultItemsPerPg,i)}};e.deleteModal=function(n){i.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"deleteObjectModal.html",controller:"deleteObjectInstanceCtrlr",controllerAs:"vm",size:"lg",appendTo:$("#citiesVw .modal-container"),resolve:{param:function(){return{target:n,targetName:n.name,save:e.save}}}})};h=function(){var n,t,i;if(e.pgsCollection.length=0,e.totalPgs>1){for(n=e.currentPgNmbr-2,t=e.currentPgNmbr+2,n<0&&(t+=0-n,n=0),t>=e.totalPgs&&(t=e.totalPgs-1);t-n<4;)n--;for(n=n<0?0:n,e.pgsCollection.push({index:0,isActive:!1,text:"",icon:"fa fa-step-backward",disabled:e.currentPgNmbr<=0}),i=n;i<=t;i++)e.pgsCollection.push({index:i,isActive:e.currentPgNmbr===i,text:String(i+1),icon:"",disabled:!1});e.pgsCollection.push({index:e.totalPgs-1,isActive:!1,text:"",icon:"fa fa-step-forward",disabled:e.currentPgNmbr>=e.totalPgs-1})}};c=function(n,t,i){n&&t&&(n.recordState=n.id>0?i?30:n.name!==t.name||n.latitude!==t.latitude||n.longitude!==t.longitude||n.active!==t.active?20:0:10)};e.populateSuccessFunc=function(n){var o,f,t,i,u;if(e.cityDetails.length=0,n.data){if(e.defCountry=n.data.defCountry,(n.data.count>0||n.data.count===0&&n.data.result&&n.data.result.length===0)&&(e.cityDetailsCountMod=0,e.cityDetailsCount=n.data.count,o=parseInt(e.cityDetailsCount/r.resultItemsPerPg),o+=e.cityDetailsCount%r.resultItemsPerPg>0?1:0,e.totalPgs=o),h(),n.data.regions)for(t=0;t<n.data.regions.length;t++)f=n.data.regions[t],f.name=r.currentLang.startsWith("en")?f.name_en:f.name_fr,e.refRegions.push(f);if(n.data.districts)for(t=0;t<n.data.districts.length;t++)e.refDistricts.push(n.data.districts[t]);if(n.data.cityGroups)for(t=0;t<n.data.cityGroups.length;t++)e.refCityGroups.push(n.data.cityGroups[t]);if(n.data.result)for(t=0;t<n.data.result.length;t++)i=n.data.result[t],i.active=i.status===1,i.__comp=jQuery.extend(!0,{},i),e.refRegions.length>0&&(u=$.grep(e.refRegions,function(n){return n.id===i.region_Id}),u&&u.length>0&&(i.region=u[0])),e.refDistricts.length>0&&(u=$.grep(e.refDistricts,function(n){return n.id===i.district_Id}),u&&u.length>0&&(i.district=u[0])),e.refCityGroups.length>0&&(u=$.grep(e.refCityGroups,function(n){return n.id===i.group_Id}),u&&u.length>0&&(i.group=u[0])),e.cityDetails.push(i),i.inEditMode=!1,i.saving=!1}};o="";s="";e.populateCityDetails=function(t,i,u,h){var c=!1,a,v;(u||o)&&(c=u!==o);o=u;f.showError=!1;f.errorstatus="";f.errormsg="";f.errorid=0;t=t?t:r.resultItemsPerPg;i=i?i:0;u=u?u:e.searchValue;a=function(n){n.data&&checkRedirectForSignIn(n.data)&&(f.errorstatus=n.status+" - "+n.statusText,f.errormsg=n.data.msg,f.errorid=n.data.id,f.showError=!0)};v=function(){h?h():toggleGlblWaitVisibility(!1)};h||toggleGlblWaitVisibility(!0);c=e.cityDetailsCountMod!==0;var y=0,p=0,w=0,l="";if(e.parentFilter&&e.parentFilter.id&&e.parentFilter.id>0){l=""+e.parentFilter.type+"-"+e.parentFilter.id+"";switch(e.parentFilter.type){case"r":y=e.parentFilter.id;break;case"d":p=e.parentFilter.id;c=!0;break;case"g":w=e.parentFilter.id;c=!0}}c=l!==s;s=l;n.post(r.urlGetCityDetails,{limit:t,offset:i,regionId:y,districtId:p,cityGroupId:w,getRefRegions:e.refRegions&&e.refRegions.length==0,getRefDistricts:e.refDistricts&&e.refDistricts.length==0,getRefCityGroups:e.refCityGroups&&e.refCityGroups.length==0,getTotalCityDetails:e.cityDetailsCount<=0||c,name:u?u:null}).then(e.populateSuccessFunc,a).finally(v)};e.revert=function(n){if(n&&n.__comp)if(n.id>0){var t=n.__comp;n.name=t.name;n.latitude=t.latitude;n.longitude=t.longitude;n.active=t.active;n.inEditMode=!1}else e.cityDetails.remove(n)};e.addCityDetail=function(){var n={id:0,country_Id:e.defCountry?e.defCountry.id:0,name:"",seqn:0,latitude:0,longitude:0,active:!0};n.__comp=jQuery.extend(!0,{},n);n.inEditMode=!0;n.saving=!1;e.cityDetails.insert(0,n)};e.save=function(i,u,o){var a,l,s;if(i){Array.isArray(i)||(i=[i]);o&&!Array.isArray(o)&&(o=[o]);var h=[],v=[],y=o&&o.length===i.length;for(a=0;a<i.length;a++)l=i[a],l&&l.__comp&&(s=jQuery.extend(!0,{},l),delete s.__comp,s.status=s.active?1:0,s.region&&(s.region_Id=s.region.id,delete s.region),s.district&&(s.district_Id=s.district.id,delete s.district),s.group&&(s.group_Id=s.group.id,delete s.group),c(s,l.__comp,y?o[a]:!1),v.push(s),l.saving=!0,h.push(l));if(h.length>0){var p=function(n){n.data&&n.data.result&&n.data.result.length>0&&h.length===n.data.result.length&&$.each(n.data.result,function(n,i){var r=h[n];i?(r.id=i.id,r.seqn=i.seqn,r.name=i.name,r.country_Id=i.country_Id,r.active=i.status===1,v[n].recordState===10&&(e.cityDetailsCountMod+=1,(!e.totalPgs||e.totalPgs<=0)&&(e.totalPgs=1)),delete r.status,delete r.recordState,r.__comp=i):(e.cityDetails.remove(r),e.cityDetailsCountMod-=1,e.cityDetailsCount+e.cityDetailsCountMod<=0&&(e.totalPgs=0));t.$apply()})},w=function(n){n.data&&checkRedirectForSignIn(n.data)&&(f.errorstatus=n.status+" - "+n.statusText,f.errormsg=n.data.msg,f.errorid=n.data.id,f.showError=!0)},b=function(){for(var n=0;n<h.length;n++)h[n].saving=!1,h[n].inEditMode=!1;u&&u()};f.showError=!1;f.errorstatus="";f.errormsg="";f.errorid=0;n.post(r.urlSaveCityDetails,{cityDetails:v}).then(p,w).finally(b)}}}}function i(n,t,i,r,u,f){var e,s,h,o;f.rVm={};e=f.rVm;e.pgsCollection=[];e.currentPgNmbr=0;e.totalPgs=0;e.regionsCount=0;e.regionsCountMod=0;e.regions=[];e.defCountry=null;e.gotoPage=function(n,t){if(n&&!n.isActive&&!n.disabled){t;var i=r.resultItemsPerPg*n.index-1;i=i<0?0:i;e.currentPgNmbr=n.index;e.populateRegions(r.resultItemsPerPg,i)}};e.deleteModal=function(n){i.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"deleteObjectModal.html",controller:"deleteObjectInstanceCtrlr",controllerAs:"vm",size:"lg",appendTo:$("#citiesVw .modal-container"),resolve:{param:function(){return{target:n,targetName:r.currentLang.startsWith("fr")?n.name_fr:n.name_en,save:e.save}}}})};s=function(){var n,t,i;if(e.pgsCollection.length=0,e.totalPgs>1){for(n=e.currentPgNmbr-2,t=e.currentPgNmbr+2,n<0&&(t+=0-n,n=0),t>=e.totalPgs&&(t=e.totalPgs-1);t-n<4;)n--;for(n=n<0?0:n,e.pgsCollection.push({index:0,isActive:!1,text:"",icon:"fa fa-step-backward",disabled:e.currentPgNmbr<=0}),i=n;i<=t;i++)e.pgsCollection.push({index:i,isActive:e.currentPgNmbr===i,text:String(i+1),icon:"",disabled:!1});e.pgsCollection.push({index:e.totalPgs-1,isActive:!1,text:"",icon:"fa fa-step-forward",disabled:e.currentPgNmbr>=e.totalPgs-1})}};h=function(n,t,i){n&&t&&(n.recordState=n.id>0?i?30:n.name_en!==t.name_en||n.name_fr!==t.name_fr||n.active!==t.active?20:0:10)};e.populateSuccessFunc=function(n){var u,i,t;if(e.regions.length=0,n.data&&(e.defCountry=n.data.defCountry,(n.data.count>0||n.data.count===0&&n.data.result&&n.data.result.length===0)&&(e.regionsCountMod=0,e.regionsCount=n.data.count,u=parseInt(e.regionsCount/r.resultItemsPerPg),u+=e.regionsCount%r.resultItemsPerPg>0?1:0,e.totalPgs=u),s(),n.data.result))for(i=0;i<n.data.result.length;i++)t=n.data.result[i],t.name=r.currentLang.startsWith("en")?t.name_en:t.name_fr,t.__comp=jQuery.extend(!0,{},t),e.regions.push(t),t.inEditMode=!1,t.saving=!1};o="";e.populateRegions=function(t,i,u,s){var h=!1,c,l;(u||o)&&(h=u!==o);o=u;f.showError=!1;f.errorstatus="";f.errormsg="";f.errorid=0;t=t?t:r.resultItemsPerPg;i=i?i:0;u=u?u:e.searchValue;c=function(n){n.data&&checkRedirectForSignIn(n.data)&&(f.errorstatus=n.status+" - "+n.statusText,f.errormsg=n.data.msg,f.errorid=n.data.id,f.showError=!0)};l=function(){s?s():toggleGlblWaitVisibility(!1)};s||toggleGlblWaitVisibility(!0);h=e.regionsCountMod!==0;n.post(r.urlGetRegions,{limit:t,offset:i,getTotalRegions:e.regionsCount<=0||h,name:u?u:null}).then(e.populateSuccessFunc,c).finally(l)};e.revert=function(n){if(n&&n.__comp)if(n.id>0){var t=n.__comp;n.name_en=t.name_en;n.name_fr=t.name_fr;n.seqn=t.seqn;n.active=t.active;n.inEditMode=!1}else e.regions.remove(n)};e.addRegion=function(){var n={id:0,country_Id:e.defCountry?e.defCountry.id:0,name_en:"",name_fr:"",seqn:0,active:!0};n.__comp=jQuery.extend(!0,{},n);n.inEditMode=!0;n.saving=!1;e.regions.insert(0,n)};e.save=function(i,u,o){var a,c,l;if(i){Array.isArray(i)||(i=[i]);o&&!Array.isArray(o)&&(o=[o]);var s=[],v=[],y=o&&o.length===i.length;for(a=0;a<i.length;a++)c=i[a],c&&c.__comp&&(l=jQuery.extend(!0,{},c),delete l.__comp,l.status=l.active?1:0,h(l,c.__comp,y?o[a]:!1),v.push(l),c.saving=!0,s.push(c));if(s.length>0){var p=function(n){n.data&&n.data.result&&n.data.result.length>0&&s.length===n.data.result.length&&$.each(n.data.result,function(n,i){var r=s[n];i?(r.id=i.id,r.legalName=i.legalName,r.civility=i.civility,r.lName=i.lName,r.fName=i.fName,r.paid=i.paid,r.active=i.active,v[n].recordState===10&&(e.regionsCountMod+=1,(!e.totalPgs||e.totalPgs<=0)&&(e.totalPgs=1)),delete r.status,delete r.recordState,r.__comp=i):(e.regions.remove(r),e.regionsCountMod-=1,e.regionsCount+e.regionsCountMod<=0&&(e.totalPgs=0));t.$apply()})},w=function(n){n.data&&checkRedirectForSignIn(n.data)&&(f.errorstatus=n.status+" - "+n.statusText,f.errormsg=n.data.msg,f.errorid=n.data.id,f.showError=!0)},b=function(){for(var n=0;n<s.length;n++)s[n].saving=!1,s[n].inEditMode=!1;u&&u()};f.showError=!1;f.errorstatus="";f.errormsg="";f.errorid=0;n.post(r.urlSaveRegions,{regions:v}).then(p,w).finally(b)}}};e.filterOnParent=function(n){n&&f.cVm.parentFilter&&(f.cVm.parentFilter.id=n.id,f.cVm.parentFilter.text=f.appProps.lbl_CityFrRgn+" "+n.name,f.cVm.parentFilter.type="r",f.tabIndex=0,f.cVm.populateCityDetails())}}function r(n,t,i,r,u,f){var e,s,h,o;f.dVm={};e=f.dVm;e.pgsCollection=[];e.currentPgNmbr=0;e.totalPgs=0;e.districtsCount=0;e.districtsCountMod=0;e.districts=[];e.defCountry=null;e.gotoPage=function(n,t){if(n&&!n.isActive&&!n.disabled){t;var i=r.resultItemsPerPg*n.index-1;i=i<0?0:i;e.currentPgNmbr=n.index;e.populateDistricts(r.resultItemsPerPg,i)}};e.deleteModal=function(n){i.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"deleteObjectModal.html",controller:"deleteObjectInstanceCtrlr",controllerAs:"vm",size:"lg",appendTo:$("#citiesVw .modal-container"),resolve:{param:function(){return{target:n,targetName:n.name,save:e.save}}}})};s=function(){var n,t,i;if(e.pgsCollection.length=0,e.totalPgs>1){for(n=e.currentPgNmbr-2,t=e.currentPgNmbr+2,n<0&&(t+=0-n,n=0),t>=e.totalPgs&&(t=e.totalPgs-1);t-n<4;)n--;for(n=n<0?0:n,e.pgsCollection.push({index:0,isActive:!1,text:"",icon:"fa fa-step-backward",disabled:e.currentPgNmbr<=0}),i=n;i<=t;i++)e.pgsCollection.push({index:i,isActive:e.currentPgNmbr===i,text:String(i+1),icon:"",disabled:!1});e.pgsCollection.push({index:e.totalPgs-1,isActive:!1,text:"",icon:"fa fa-step-forward",disabled:e.currentPgNmbr>=e.totalPgs-1})}};h=function(n,t,i){n&&t&&(n.recordState=n.id>0?i?30:n.name!==t.name||n.latitude!==t.latitude||n.longitude!==t.longitude||n.active!==t.active?20:0:10)};e.populateSuccessFunc=function(n){var u,i,t;if(e.districts.length=0,n.data&&(e.defCountry=n.data.defCountry,(n.data.count>0||n.data.count===0&&n.data.result&&n.data.result.length===0)&&(e.districtsCountMod=0,e.districtsCount=n.data.count,u=parseInt(e.districtsCount/r.resultItemsPerPg),u+=e.districtsCount%r.resultItemsPerPg>0?1:0,e.totalPgs=u),s(),n.data.result))for(i=0;i<n.data.result.length;i++)t=n.data.result[i],t.active=t.status===1,t.__comp=jQuery.extend(!0,{},t),e.districts.push(t),t.inEditMode=!1,t.saving=!1};o="";e.populateDistricts=function(t,i,u,s){var h=!1,c,l;(u||o)&&(h=u!==o);o=u;f.showError=!1;f.errorstatus="";f.errormsg="";f.errorid=0;t=t?t:r.resultItemsPerPg;i=i?i:0;u=u?u:e.searchValue;c=function(n){n.data&&checkRedirectForSignIn(n.data)&&(f.errorstatus=n.status+" - "+n.statusText,f.errormsg=n.data.msg,f.errorid=n.data.id,f.showError=!0)};l=function(){s?s():toggleGlblWaitVisibility(!1)};s||toggleGlblWaitVisibility(!0);h=e.districtsCountMod!==0;n.post(r.urlGetDistricts,{limit:t,offset:i,getTotalDistricts:e.districtsCount<=0||h,name:u?u:null}).then(e.populateSuccessFunc,c).finally(l)};e.revert=function(n){if(n&&n.__comp)if(n.id>0){var t=n.__comp;n.name=t.name;n.latitude=t.latitude;n.longitude=t.longitude;n.active=t.active;n.inEditMode=!1}else e.districts.remove(n)};e.addDistrict=function(){var n={id:0,country_Id:e.defCountry?e.defCountry.id:0,name:"",seqn:0,latitude:0,longitude:0,active:!0};n.__comp=jQuery.extend(!0,{},n);n.inEditMode=!0;n.saving=!1;e.districts.insert(0,n)};e.save=function(i,u,o){var a,c,l;if(i){Array.isArray(i)||(i=[i]);o&&!Array.isArray(o)&&(o=[o]);var s=[],v=[],y=o&&o.length===i.length;for(a=0;a<i.length;a++)c=i[a],c&&c.__comp&&(l=jQuery.extend(!0,{},c),delete l.__comp,l.status=l.active?1:0,h(l,c.__comp,y?o[a]:!1),v.push(l),c.saving=!0,s.push(c));if(s.length>0){var p=function(n){n.data&&n.data.result&&n.data.result.length>0&&s.length===n.data.result.length&&$.each(n.data.result,function(n,i){var r=s[n];i?(r.id=i.id,r.seqn=i.seqn,r.name=i.name,r.country_Id=i.country_Id,r.active=i.status===1,v[n].recordState===10&&(e.districtsCountMod+=1,(!e.totalPgs||e.totalPgs<=0)&&(e.totalPgs=1)),delete r.status,delete r.recordState,r.__comp=i):(e.districts.remove(r),e.districtsCountMod-=1,e.districtsCount+e.districtsCountMod<=0&&(e.totalPgs=0));t.$apply()})},w=function(n){n.data&&checkRedirectForSignIn(n.data)&&(f.errorstatus=n.status+" - "+n.statusText,f.errormsg=n.data.msg,f.errorid=n.data.id,f.showError=!0)},b=function(){for(var n=0;n<s.length;n++)s[n].saving=!1,s[n].inEditMode=!1;u&&u()};f.showError=!1;f.errorstatus="";f.errormsg="";f.errorid=0;n.post(r.urlSaveDistricts,{districts:v}).then(p,w).finally(b)}}};e.filterOnParent=function(n){n&&f.cVm.parentFilter&&(f.cVm.parentFilter.id=n.id,f.cVm.parentFilter.text=f.appProps.lbl_CityFrDst+" "+n.name,f.cVm.parentFilter.type="d",f.tabIndex=0,f.cVm.populateCityDetails())}}function u(n,t,i,r,u,f){var e,s,h,o;f.gVm={};e=f.gVm;e.pgsCollection=[];e.currentPgNmbr=0;e.totalPgs=0;e.cityGroupsCount=0;e.cityGroupsCountMod=0;e.cityGroups=[];e.defCountry=null;e.gotoPage=function(n,t){if(n&&!n.isActive&&!n.disabled){t;var i=r.resultItemsPerPg*n.index-1;i=i<0?0:i;e.currentPgNmbr=n.index;e.populateCityGroups(r.resultItemsPerPg,i)}};e.deleteModal=function(n){i.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"deleteObjectModal.html",controller:"deleteObjectInstanceCtrlr",controllerAs:"vm",size:"lg",appendTo:$("#citiesVw .modal-container"),resolve:{param:function(){return{target:n,targetName:n.name,save:e.save}}}})};s=function(){var n,t,i;if(e.pgsCollection.length=0,e.totalPgs>1){for(n=e.currentPgNmbr-2,t=e.currentPgNmbr+2,n<0&&(t+=0-n,n=0),t>=e.totalPgs&&(t=e.totalPgs-1);t-n<4;)n--;for(n=n<0?0:n,e.pgsCollection.push({index:0,isActive:!1,text:"",icon:"fa fa-step-backward",disabled:e.currentPgNmbr<=0}),i=n;i<=t;i++)e.pgsCollection.push({index:i,isActive:e.currentPgNmbr===i,text:String(i+1),icon:"",disabled:!1});e.pgsCollection.push({index:e.totalPgs-1,isActive:!1,text:"",icon:"fa fa-step-forward",disabled:e.currentPgNmbr>=e.totalPgs-1})}};h=function(n,t,i){n&&t&&(n.recordState=n.id>0?i?30:n.name!==t.name||n.latitude!==t.latitude||n.longitude!==t.longitude||n.active!==t.active?20:0:10)};e.populateSuccessFunc=function(n){var u,i,t;if(e.cityGroups.length=0,n.data&&(e.defCountry=n.data.defCountry,(n.data.count>0||n.data.count===0&&n.data.result&&n.data.result.length===0)&&(e.cityGroupsCountMod=0,e.cityGroupsCount=n.data.count,u=parseInt(e.cityGroupsCount/r.resultItemsPerPg),u+=e.cityGroupsCount%r.resultItemsPerPg>0?1:0,e.totalPgs=u),s(),n.data.result))for(i=0;i<n.data.result.length;i++)t=n.data.result[i],t.active=t.status===1,t.__comp=jQuery.extend(!0,{},t),e.cityGroups.push(t),t.inEditMode=!1,t.saving=!1};o="";e.populateCityGroups=function(t,i,u,s){var h=!1,c,l;(u||o)&&(h=u!==o);o=u;f.showError=!1;f.errorstatus="";f.errormsg="";f.errorid=0;t=t?t:r.resultItemsPerPg;i=i?i:0;u=u?u:e.searchValue;c=function(n){n.data&&checkRedirectForSignIn(n.data)&&(f.errorstatus=n.status+" - "+n.statusText,f.errormsg=n.data.msg,f.errorid=n.data.id,f.showError=!0)};l=function(){s?s():toggleGlblWaitVisibility(!1)};s||toggleGlblWaitVisibility(!0);h=e.cityGroupsCountMod!==0;n.post(r.urlGetCityGroups,{limit:t,offset:i,getTotalCityGroups:e.cityGroupsCount<=0||h,name:u?u:null}).then(e.populateSuccessFunc,c).finally(l)};e.revert=function(n){if(n&&n.__comp)if(n.id>0){var t=n.__comp;n.name=t.name;n.latitude=t.latitude;n.longitude=t.longitude;n.active=t.active;n.inEditMode=!1}else e.cityGroups.remove(n)};e.addCityGroup=function(){var n={id:0,country_Id:e.defCountry?e.defCountry.id:0,name:"",seqn:0,latitude:0,longitude:0,active:!0};n.__comp=jQuery.extend(!0,{},n);n.inEditMode=!0;n.saving=!1;e.cityGroups.insert(0,n)};e.save=function(i,u,o){var a,c,l;if(i){Array.isArray(i)||(i=[i]);o&&!Array.isArray(o)&&(o=[o]);var s=[],v=[],y=o&&o.length===i.length;for(a=0;a<i.length;a++)c=i[a],c&&c.__comp&&(l=jQuery.extend(!0,{},c),delete l.__comp,l.status=l.active?1:0,h(l,c.__comp,y?o[a]:!1),v.push(l),c.saving=!0,s.push(c));if(s.length>0){var p=function(n){n.data&&n.data.result&&n.data.result.length>0&&s.length===n.data.result.length&&$.each(n.data.result,function(n,i){var r=s[n];i?(r.id=i.id,r.seqn=i.seqn,r.name=i.name,r.country_Id=i.country_Id,r.active=i.status===1,v[n].recordState===10&&(e.cityGroupsCountMod+=1,(!e.totalPgs||e.totalPgs<=0)&&(e.totalPgs=1)),delete r.status,delete r.recordState,r.__comp=i):(e.cityGroups.remove(r),e.cityGroupsCountMod-=1,e.cityGroupsCount+e.cityGroupsCountMod<=0&&(e.totalPgs=0));t.$apply()})},w=function(n){n.data&&checkRedirectForSignIn(n.data)&&(f.errorstatus=n.status+" - "+n.statusText,f.errormsg=n.data.msg,f.errorid=n.data.id,f.showError=!0)},b=function(){for(var n=0;n<s.length;n++)s[n].saving=!1,s[n].inEditMode=!1;u&&u()};f.showError=!1;f.errorstatus="";f.errormsg="";f.errorid=0;n.post(r.urlSaveCityGroups,{cityGroups:v}).then(p,w).finally(b)}}};e.filterOnParent=function(n){n&&f.cVm.parentFilter&&(f.cVm.parentFilter.id=n.id,f.cVm.parentFilter.text=f.appProps.lbl_CityFrGrp+" "+n.name,f.cVm.parentFilter.type="g",f.tabIndex=0,f.cVm.populateCityDetails())}}function f(n,t,i){var r=this;r.appProps=t;r.target=i.target;r.targetName=i.targetName;r.yes=function(){n.close(r.target);toggleGlblWaitVisibility(!0);i.save(i.target,function(){toggleGlblWaitVisibility(!1)},!0)};r.no=function(){n.close()}}angular.module("app-mainmenu").controller("citiesCtrlr",["$http","$scope","$uibModal","appProps","headerConfigService",n]);angular.module("app-mainmenu").controller("deleteObjectInstanceCtrlr",["$uibModalInstance","appProps","param",f])})();