(function(){"use strict";function n(n,t,i,r,u){var f,s;$("[data-toggle=tooltip]").tooltip({trigger:"hover"});u.reset();u.title=r.lbl_Clnts;u.showToolBar=!0;u.showSearchCtrl=!0;u.showSaveBtn=!1;u.addBtnTltp=r.msg_AddClnts;u.refreshBtnTltp=r.msg_RfrshClnts;u.saveBtnTltp=r.msg_SaveClnts;f=this;f.appProps=r;f.pgsCollection=[];f.currentPgNmbr=0;f.totalPgs=0;f.clientsCount=0;f.clientsCountMod=0;f.clients=[];f.gotoPage=function(n,t){if(n&&!n.isActive&&!n.disabled){t;var i=r.resultItemsPerPg*n.index-1;i=i<0?0:i;f.currentPgNmbr=n.index;f.populateClients(r.resultItemsPerPg,i)}};f.deleteModal=function(n){i.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"deleteClientModal.html",controller:"deleteClientInstanceCtrlr",controllerAs:"vm",size:"lg",appendTo:$("#clientsVw .modal-container"),resolve:{param:function(){return{client:n,save:f.save}}}})};var h=function(){var n,t,i;if(f.pgsCollection.length=0,f.totalPgs>1){for(n=f.currentPgNmbr-2,t=f.currentPgNmbr+2,n<0&&(t+=0-n,n=0),t>=f.totalPgs&&(t=f.totalPgs-1);t-n<4;)n--;for(n=n<0?0:n,f.pgsCollection.push({index:0,isActive:!1,text:"",icon:"fa fa-step-backward",disabled:f.currentPgNmbr<=0}),i=n;i<=t;i++)f.pgsCollection.push({index:i,isActive:f.currentPgNmbr===i,text:String(i+1),icon:"",disabled:!1});f.pgsCollection.push({index:f.totalPgs-1,isActive:!1,text:"",icon:"fa fa-step-forward",disabled:f.currentPgNmbr>=f.totalPgs-1})}},e=function(n){n&&(n.dispName=(n.civility?n.civility.toUpperCase()+" ":"")+(n.lName===null?"":n.lName.toUpperCase()+(n.fName?", ":""))+(n.fName?n.fName:""))},c=function(n,t,i){n&&t&&(n.recordState=n.id>0?i?30:n.legalName!==t.legalName||n.civility!==t.civility||n.lName!==t.lName||n.fName!==t.fName||n.paid!==t.paid||n.active!==t.active?20:0:10)},o="";f.populateClients=function(t,i,u){var s=!1;s=u||o?u!==o||f.clientsCountMod!==0:f.clientsCountMod!==0;o=u;f.showError=!1;f.errorstatus="";f.errormsg="";f.errorid=0;t=t?t:r.resultItemsPerPg;i=i?i:0;u=u?u:f.searchValue;var c=function(n){var u,i,t;if(f.clients.length=0,n.data&&((n.data.count>0||n.data.count===0&&n.data.result&&n.data.result.length===0)&&(f.clientsCountMod=0,f.clientsCount=n.data.count,u=parseInt(f.clientsCount/r.resultItemsPerPg),u+=f.clientsCount%r.resultItemsPerPg>0?1:0,f.totalPgs=u),h(),n.data.result))for(i=0;i<n.data.result.length;i++)t=n.data.result[i],t.__comp=jQuery.extend(!0,{},t),f.clients.push(t),t.inEditMode=!1,t.saving=!1,e(t)},l=function(n){n.data&&checkRedirectForSignIn(n.data)&&(f.errorstatus=n.status+" - "+n.statusText,f.errormsg=n.data.msg,f.errorid=n.data.id,f.showError=!0)},a=function(){toggleGlblWaitVisibility(!1)};toggleGlblWaitVisibility(!0);n.post(r.urlGetClients,{limit:t,offset:i,getTotalClients:f.clientsCount<=0||s,allNames:u?u:null}).then(c,l).finally(a)};f.revert=function(n){if(n&&n.__comp)if(n.id>0){var t=n.__comp;n.legalName=t.legalName;n.civility=t.civility;n.lName=t.lName;n.fName=t.fName;n.paid=t.paid;n.active=t.active;e(n);n.inEditMode=!1}else f.clients.remove(n)};f.save=function(i,u,o){var a,h,l;if(i){Array.isArray(i)||(i=[i]);o&&!Array.isArray(o)&&(o=[o]);var s=[],v=[],y=o&&o.length===i.length;for(a=0;a<i.length;a++)h=i[a],h&&h.__comp&&(l=jQuery.extend(!0,{},h),delete l.__comp,l.status=l.active?1:0,c(l,h.__comp,y?o[a]:!1),v.push(l),h.saving=!0,s.push(h));if(s.length>0){var p=function(n){n.data&&n.data.result&&n.data.result.length>0&&s.length===n.data.result.length&&$.each(n.data.result,function(n,i){var r=s[n];i?(r.id=i.id,r.legalName=i.legalName,r.civility=i.civility,r.lName=i.lName,r.fName=i.fName,r.paid=i.paid,r.active=i.active,v[n].recordState===10&&(f.clientsCountMod+=1,(!f.totalPgs||f.totalPgs<=0)&&(f.totalPgs=1)),e(r),delete r.status,delete r.recordState,r.__comp=i):(f.clients.remove(r),f.clientsCountMod-=1,f.clientsCount+f.clientsCountMod<=0&&(f.totalPgs=0));t.$apply()})},w=function(n){n.data&&checkRedirectForSignIn(n.data)&&(f.errorstatus=n.status+" - "+n.statusText,f.errormsg=n.data.msg,f.errorid=n.data.id,f.showError=!0)},b=function(){for(var n=0;n<s.length;n++)s[n].saving=!1,s[n].inEditMode=!1;u&&u()};f.showError=!1;f.errorstatus="";f.errormsg="";f.errorid=0;n.post(r.urlSaveClients,{clients:v}).then(p,w).finally(b)}}};s=function(){var n=$(this);n.hasClass("refresh")?t.$apply(function(){f.populateClients()}):n.hasClass("add")&&t.$apply(function(){var n={id:0,legalName:"",civility:"",lName:"",fName:"",paid:!1,active:!0};n.__comp=jQuery.extend(!0,{},n);n.inEditMode=!0;n.saving=!1;f.clients.insert(0,n)})};$("#searchBar .btn.btn-tb").on("click",s);$("#searchBar").on("searchGo",function(n,i){i&&i.searchValue&&t.$apply(function(){f.searchValue=i.searchValue;f.populateClients(r.resultItemsPerPg,0,i.searchValue)})});$("#searchBar").on("searchClear",function(){t.$apply(function(){f.searchValue="";f.populateClients(r.resultItemsPerPg,0)})})}function t(n,t,i){var r=this;r.appProps=t;r.client=i.client;r.yes=function(){n.close(r.client);toggleGlblWaitVisibility(!0);i.save(i.client,function(){toggleGlblWaitVisibility(!1)},!0)};r.no=function(){n.close()}}angular.module("app-mainmenu").controller("clientsCtrlr",["$http","$scope","$uibModal","appProps","headerConfigService",n]);angular.module("app-mainmenu").controller("deleteClientInstanceCtrlr",["$uibModalInstance","appProps","param",t])})();